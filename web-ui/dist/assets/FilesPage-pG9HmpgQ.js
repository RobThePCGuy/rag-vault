import{a as k,j as e}from"./query-DPt-uCb6.js";import{u as P,c as L}from"./vendor-C2QPsZ3S.js";import{j as F,k as S,l as T,S as R,T as M}from"./index-D068MV_o.js";function I({file:s,onDelete:l,isDeleting:n}){const[o,r]=k.useState(!1),p=P(),j=s.source||s.filePath.split(/[/\\]/).pop()||s.filePath,i=s.filePath.includes("raw-data"),d=()=>{s.source?l({source:s.source}):l({filePath:s.filePath}),r(!1)},m=()=>{const c=new URLSearchParams({path:s.filePath});p(`/read?${c.toString()}`)};return e.jsxs("div",{className:"rounded-lg p-4 flex items-center justify-between gap-4",style:{background:"var(--ws-surface-raised)",border:"1px solid var(--ws-border)"},children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium truncate",style:{color:"var(--ws-text)"},title:s.source||s.filePath,children:j}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm",style:{color:"var(--ws-text-muted)"},children:[e.jsxs("span",{children:[s.chunkCount," chunks"]}),i&&e.jsx("span",{style:{color:"var(--ws-accent)"},children:"Ingested content"})]}),s.source&&e.jsx("p",{className:"text-xs truncate mt-1",style:{color:"var(--ws-text-muted)"},title:s.filePath,children:s.filePath})]}),e.jsx("div",{className:"flex items-center gap-2",children:o?e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:d,disabled:n,className:"px-3 py-1.5 text-sm bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 transition-colors",children:"Confirm"}),e.jsx("button",{type:"button",onClick:()=>r(!1),disabled:n,className:"px-3 py-1.5 text-sm rounded-lg transition-colors",style:{color:"var(--ws-text-secondary)",background:"var(--ws-surface-1)"},children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:m,className:"px-3 py-1.5 text-sm text-green-600 hover:bg-green-50 rounded-lg transition-colors",children:"Read"}),e.jsx("button",{type:"button",onClick:()=>r(!0),className:"px-3 py-1.5 text-sm text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:"Delete"})]})})]})}function A({files:s,onDelete:l,isDeleting:n}){return s.length===0?e.jsxs("div",{className:"text-center py-12",style:{color:"var(--ws-text-muted)"},children:[e.jsx("p",{children:"No files ingested yet."}),e.jsx("p",{className:"text-sm mt-1",children:"Upload a file or paste content to get started."})]}):e.jsx("div",{className:"space-y-2",children:s.map(o=>e.jsx(I,{file:o,onDelete:l,isDeleting:n},o.filePath))})}function D(){const[s,l]=L(),{files:n,isLoading:o,error:r,deleteFile:p,isDeleting:j}=F(),{collections:i}=S(),{tags:d,getTagsForTarget:m}=T(),c=s.get("collection")||"",x=s.get("tag")||"",h=i.find(t=>t.id===c),f=d.find(t=>t.id===x),u=k.useMemo(()=>{let t=n;if(c&&h){const a=new Set(h.documents);t=t.filter(b=>a.has(b.filePath))}return x&&(t=t.filter(a=>m("document",a.filePath).some(C=>C.id===x))),t},[n,c,h,x,m]),v=t=>{const a=new URLSearchParams(s);t?a.set("collection",t):a.delete("collection"),l(a)},w=t=>{const a=new URLSearchParams(s);t?a.set("tag",t):a.delete("tag"),l(a)},y=()=>{l({})},g=c||x;return e.jsxs("div",{className:"ws-page max-w-4xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"ws-page-title text-2xl font-bold mb-2",children:"Ingested Files"}),e.jsx("p",{style:{color:"var(--ws-text-secondary)"},children:"Manage your knowledge base content."})]}),n.length>0&&e.jsx("span",{className:"text-sm",style:{color:"var(--ws-text-muted)"},children:u.length===n.length?`${n.length} file${n.length!==1?"s":""}`:`${u.length} of ${n.length} files`})]}),(i.length>0||d.length>0)&&e.jsxs("div",{className:"flex flex-wrap items-center gap-3 p-3 rounded-lg",style:{background:"var(--ws-surface-1)",border:"1px solid var(--ws-border)"},children:[e.jsx("span",{className:"text-sm font-medium",style:{color:"var(--ws-text-secondary)"},children:"Filter by:"}),i.length>0&&e.jsxs("select",{value:c,onChange:t=>v(t.target.value),className:"ws-select text-sm px-3 py-1.5",children:[e.jsx("option",{value:"",children:"All collections"}),i.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.documents.length,")"]},t.id))]}),d.length>0&&e.jsxs("select",{value:x,onChange:t=>w(t.target.value),className:"ws-select text-sm px-3 py-1.5",children:[e.jsx("option",{value:"",children:"All tags"}),d.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),g&&e.jsx("button",{type:"button",onClick:y,className:"text-sm hover:underline",style:{color:"var(--ws-accent)"},children:"Clear filters"})]}),g&&e.jsxs("div",{className:"flex flex-wrap gap-2",children:[h&&e.jsx(N,{label:h.name,type:"collection",onRemove:()=>v("")}),f&&e.jsx(N,{label:f.name,type:"tag",color:f.color,onRemove:()=>w("")})]}),o?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("span",{style:{color:"var(--ws-text-faint)"},children:e.jsx(R,{})}),e.jsx("span",{className:"ml-3",style:{color:"var(--ws-text-muted)"},children:"Loading files..."})]}):r?e.jsxs("div",{className:"ws-error-box rounded-lg",children:[e.jsx("p",{className:"font-medium",children:"Error loading files"}),e.jsx("p",{className:"text-sm",children:r.message})]}):u.length===0?e.jsxs("div",{className:"ws-surface text-center py-12",children:[e.jsx($,{className:"w-10 h-10 mx-auto mb-3",style:{color:"var(--ws-text-faint)"}}),e.jsx("p",{style:{color:"var(--ws-text-secondary)"},children:g?"No files match the selected filters.":"No files ingested yet."}),g&&e.jsx("button",{type:"button",onClick:y,className:"mt-2 text-sm hover:underline",style:{color:"var(--ws-accent)"},children:"Clear filters"})]}):e.jsx(A,{files:u,onDelete:p,isDeleting:j})]})}function N({label:s,type:l,color:n,onRemove:o}){const r=l==="tag"&&n?M[n]?.bg:void 0;return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 text-sm rounded-full ${r||""}`,style:r?void 0:{background:"var(--ws-surface-2)"},children:[l==="collection"?e.jsx(B,{className:"w-3.5 h-3.5",style:{color:"var(--ws-text-muted)"}}):e.jsx(E,{className:"w-3.5 h-3.5",style:{color:"var(--ws-text-muted)"}}),e.jsx("span",{style:{color:"var(--ws-text-secondary)"},children:s}),e.jsx("button",{type:"button",onClick:o,className:"p-0.5 rounded-full hover:bg-black/10 dark:hover:bg-white/10",children:e.jsx(U,{className:"w-3 h-3",style:{color:"var(--ws-text-muted)"}})})]})}function $({className:s,style:l}){return e.jsx("svg",{className:s,style:l,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})})}function B({className:s,style:l}){return e.jsx("svg",{className:s,style:l,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})})}function E({className:s,style:l}){return e.jsx("svg",{className:s,style:l,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})})}function U({className:s,style:l}){return e.jsx("svg",{className:s,style:l,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}export{D as FilesPage};
