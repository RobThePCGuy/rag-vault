import{j as e,a as i,c as u}from"./query-DPt-uCb6.js";import{u as x}from"./vendor-C2QPsZ3S.js";import{s as m}from"./index-D068MV_o.js";function h({icon:t,title:s,description:r,action:n}){return e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[t&&e.jsx("div",{className:"mb-4",style:{color:"var(--ws-text-muted)"},children:t}),e.jsx("h3",{className:"text-lg font-medium",style:{color:"var(--ws-text)"},children:s}),r&&e.jsx("p",{className:"mt-1 text-sm max-w-sm",style:{color:"var(--ws-text-muted)"},children:r}),n&&e.jsx("button",{type:"button",onClick:n.onClick,className:"mt-4 px-4 py-2 text-sm font-medium rounded-lg transition-colors",style:{color:"var(--ws-accent)",background:"var(--ws-accent-subtle)"},children:n.label})]})}function f({isOpen:t,onClose:s,title:r,children:n}){const a=i.useRef(null),o=i.useRef(null);return i.useEffect(()=>{if(t){o.current=document.activeElement,a.current?.focus();const l=c=>{c.key==="Escape"&&s()};return document.addEventListener("keydown",l),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",l),document.body.style.overflow="",o.current instanceof HTMLElement&&o.current.focus()}}},[t,s]),t?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 transition-opacity",onClick:s,"aria-hidden":"true"}),e.jsxs("div",{ref:a,tabIndex:-1,className:"relative rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[85vh] flex flex-col",style:{background:"var(--ws-surface-raised)"},children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b",style:{borderColor:"var(--ws-border)"},children:[e.jsx("h2",{id:"modal-title",className:"text-lg font-semibold",style:{color:"var(--ws-text)"},children:r}),e.jsx("button",{type:"button",onClick:s,className:"transition-colors",style:{color:"var(--ws-text-muted)"},"aria-label":"Close modal",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:n})]})]}):null}function p(){const[t,s]=i.useState([]),[r,n]=i.useState(!1),a=u({mutationFn:({query:c,limit:d})=>m(c,d),onSuccess:c=>{s(c),n(!0)}});return{results:t,search:(c,d)=>{a.mutate({query:c,limit:d})},clear:()=>{s([]),n(!1)},isLoading:a.isPending,error:a.error,hasSearched:r}}function y({result:t,isOpen:s,onClose:r}){const[n,a]=i.useState(!1),o=t.source||t.filePath,l=i.useRef(null);i.useEffect(()=>()=>{l.current&&clearTimeout(l.current)},[]);const c=async()=>{try{await navigator.clipboard.writeText(t.text),a(!0),l.current&&clearTimeout(l.current),l.current=setTimeout(()=>a(!1),2e3)}catch{}};return e.jsx(f,{isOpen:s,onClose:r,title:"Document Preview",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 p-4 rounded-lg text-sm",style:{background:"var(--ws-surface-1)"},children:[e.jsxs("div",{children:[e.jsx("span",{style:{color:"var(--ws-text-muted)"},children:"Source:"}),e.jsx("p",{className:"font-medium break-all",style:{color:"var(--ws-text)"},children:o})]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:"var(--ws-text-muted)"},children:"Chunk:"}),e.jsxs("p",{className:"font-medium",style:{color:"var(--ws-text)"},children:["#",t.chunkIndex]})]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:"var(--ws-text-muted)"},children:"Score:"}),e.jsx("p",{className:"font-medium",style:{color:"var(--ws-text)"},children:t.score.toFixed(4)})]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:"var(--ws-text-muted)"},children:"File Path:"}),e.jsx("p",{className:"font-medium break-all truncate",style:{color:"var(--ws-text)"},title:t.filePath,children:t.filePath})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium",style:{color:"var(--ws-text-secondary)"},children:"Content"}),e.jsx("button",{type:"button",onClick:c,className:"flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded transition-colors",style:{color:"var(--ws-text-secondary)",background:"var(--ws-surface-1)"},children:n?e.jsxs(e.Fragment,{children:[e.jsx(j,{}),"Copied"]}):e.jsxs(e.Fragment,{children:[e.jsx(v,{}),"Copy"]})})]}),e.jsx("div",{className:"p-4 rounded-lg",style:{background:"var(--ws-surface-raised)",border:"1px solid var(--ws-border)"},children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",style:{color:"var(--ws-text-secondary)"},children:t.text})})]})]})})}function v(){return e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}function j(){return e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}function w({onSearch:t,isLoading:s}){const[r,n]=i.useState(""),[a,o]=i.useState(10),l=c=>{c.preventDefault(),r.trim()&&t(r.trim(),a)};return e.jsxs("form",{onSubmit:l,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"query",className:"block text-sm font-medium mb-1",style:{color:"var(--ws-text-secondary)"},children:"Search Query"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",id:"query",value:r,onChange:c=>n(c.target.value),placeholder:"Enter your search query...",className:"ws-input flex-1 px-4 py-2",disabled:s}),e.jsx("button",{type:"submit",disabled:s||!r.trim(),className:"ws-button px-6 py-2 font-medium rounded-lg transition-colors","data-variant":"primary",children:s?"Searching...":"Search"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{htmlFor:"limit",className:"text-sm",style:{color:"var(--ws-text-secondary)"},children:"Results limit:"}),e.jsxs("select",{id:"limit",value:a,onChange:c=>o(Number(c.target.value)),className:"ws-select px-3 py-1.5 text-sm",children:[e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"}),e.jsx("option",{value:50,children:"50"})]})]})]})}function b({results:t,hasSearched:s}){const[r,n]=i.useState(null),a=x(),o=l=>{const c=new URLSearchParams({path:l.filePath});c.set("chunk",String(l.chunkIndex)),a(`/read?${c.toString()}`)};return s?t.length===0?e.jsx(h,{icon:e.jsx(N,{}),title:"No results found",description:"Try different keywords or a broader query."}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h2",{className:"text-lg font-medium",style:{color:"var(--ws-text)"},children:["Results (",t.length,")"]}),e.jsx("div",{className:"space-y-3",children:t.map((l,c)=>e.jsx(g,{result:l,rank:c+1,onView:()=>n(l),onRead:()=>o(l)},`${l.filePath}-${l.chunkIndex}`))}),r&&e.jsx(y,{result:r,isOpen:!0,onClose:()=>n(null)})]}):null}function g({result:t,rank:s,onView:r,onRead:n}){const a=t.source||t.filePath,o=C(t.score);return e.jsxs("div",{className:"ws-surface p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-medium",style:{color:"var(--ws-text-faint)"},children:["#",s]}),e.jsx("h3",{className:"font-medium truncate",style:{color:"var(--ws-text)"},title:a,children:k(a)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded-full ${o}`,title:`Distance score: ${t.score.toFixed(4)}`,children:S(t.score)}),e.jsx("button",{type:"button",onClick:n,className:"px-2 py-1 text-xs font-medium rounded transition-colors",style:{color:"var(--ws-success)"},children:"Read"}),e.jsx("button",{type:"button",onClick:r,className:"px-2 py-1 text-xs font-medium rounded transition-colors",style:{color:"var(--ws-accent)"},children:"View"})]})]}),e.jsx("p",{className:"text-sm whitespace-pre-wrap line-clamp-4",style:{color:"var(--ws-text-secondary)"},children:t.text}),e.jsxs("div",{className:"mt-2 flex items-center gap-3 text-xs",style:{color:"var(--ws-text-faint)"},children:[e.jsxs("span",{children:["Chunk #",t.chunkIndex]}),t.source&&e.jsx("span",{className:"truncate",title:t.filePath,children:t.filePath.split("/").pop()})]})]})}function N(){return e.jsx("svg",{className:"h-12 w-12",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}function k(t){if(t.startsWith("/")||t.includes("\\"))return t.split(/[/\\]/).pop()||t;if(t.startsWith("http"))try{const s=new URL(t);return s.hostname+s.pathname.slice(0,30)+(s.pathname.length>30?"...":"")}catch{return`${t.slice(0,40)}...`}return t}function S(t){return t<.3?"Excellent":t<.5?"Good":t<.7?"Fair":"Low"}function C(t){return t<.3?"bg-green-100 text-green-800":t<.5?"bg-blue-100 text-blue-800":t<.7?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}function P(){const{results:t,search:s,isLoading:r,error:n,hasSearched:a}=p();return e.jsxs("div",{className:"ws-page max-w-4xl mx-auto space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"ws-page-title text-2xl font-bold mb-2",children:"Search Documents"}),e.jsx("p",{style:{color:"var(--ws-text-secondary)"},children:"Search through your ingested documents using semantic and keyword matching."})]}),e.jsx("div",{className:"ws-surface p-6",children:e.jsx(w,{onSearch:s,isLoading:r})}),n&&e.jsxs("div",{className:"ws-error-box rounded-lg",children:[e.jsx("p",{className:"font-medium",children:"Search Error"}),e.jsx("p",{className:"text-sm",children:n.message})]}),!r&&!a&&!n&&e.jsx("div",{className:"text-center py-12",style:{color:"var(--ws-text-muted)"},children:e.jsx("p",{children:"Enter a search query to find relevant documents."})}),e.jsx(b,{results:t,hasSearched:a&&!r})]})}export{P as SearchPage};
