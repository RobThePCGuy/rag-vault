const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ReaderPage-CwMN03NU.js","assets/query-DPt-uCb6.js","assets/ReaderSettingsContext-CkSjqsRh.js","assets/vendor-C2QPsZ3S.js","assets/motion-CKwJwI3J.js","assets/SearchPage-DAltjnLL.js","assets/UploadPage-eyfSjL4u.js","assets/FilesPage-pG9HmpgQ.js","assets/CollectionsPage-BDmEfv3V.js","assets/StatusPage-powRGmW3.js","assets/format-DOJ3IkRX.js","assets/SettingsPage-C6J5BITP.js"])))=>i.map(i=>d[i]);
import{a,j as i,u as q,b as H,c as $,Q as Ye,d as Ze}from"./query-DPt-uCb6.js";import{r as et,u as tt,R as nt,a as J,N as st,b as ot,B as rt}from"./vendor-C2QPsZ3S.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&e(l)}).observe(document,{childList:!0,subtree:!0});function s(t){const r={};return t.integrity&&(r.integrity=t.integrity),t.referrerPolicy&&(r.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?r.credentials="include":t.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function e(t){if(t.ep)return;t.ep=!0;const r=s(t);fetch(t.href,r)}})();var ee={},le;function at(){if(le)return ee;le=1;var n=et();return ee.createRoot=n.createRoot,ee.hydrateRoot=n.hydrateRoot,ee}var it=at();class lt extends a.Component{constructor(o){super(o),this.state={hasError:!1,error:null}}static getDerivedStateFromError(o){return{hasError:!0,error:o}}componentDidCatch(o,s){console.error("ErrorBoundary caught an error:",o,s)}handleRetry=()=>{this.setState({hasError:!1,error:null})};render(){return this.state.hasError?this.props.fallback?this.props.fallback:i.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",style:{background:"var(--ws-surface-1)"},children:i.jsxs("div",{className:"max-w-md w-full rounded-lg shadow-lg p-6 text-center",style:{background:"var(--ws-surface-raised)"},children:[i.jsx("div",{className:"text-red-500 mb-4",children:i.jsx("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),i.jsx("h1",{className:"text-xl font-semibold mb-2",style:{color:"var(--ws-text)"},children:"Something went wrong"}),i.jsx("p",{className:"mb-4",style:{color:"var(--ws-text-secondary)"},children:"An unexpected error occurred. Please try again."}),this.state.error&&i.jsx("pre",{className:"text-left text-sm p-3 rounded mb-4 overflow-auto max-h-32",style:{background:"var(--ws-surface-1)",color:"var(--ws-text-secondary)"},children:this.state.error.message}),i.jsxs("div",{className:"flex gap-3 justify-center",children:[i.jsx("button",{type:"button",onClick:this.handleRetry,className:"px-4 py-2 text-white rounded-lg transition-colors",style:{background:"var(--ws-accent)"},children:"Try Again"}),i.jsx("button",{type:"button",onClick:()=>window.location.reload(),className:"px-4 py-2 rounded-lg transition-colors",style:{background:"var(--ws-surface-2)",color:"var(--ws-text-secondary)"},children:"Reload Page"})]})]})}):this.props.children}}const ce={docId:null,chunkIndex:null,chunkRef:null,source:null},Ne=a.createContext(null);function ct({children:n}){const[o,s]=a.useState(ce),e=a.useCallback(r=>{s({docId:r.docId,chunkIndex:r.chunkIndex??null,chunkRef:r.chunkRef??null,source:r.source})},[]),t=a.useCallback(()=>{s(ce)},[]);return i.jsx(Ne.Provider,{value:{selection:o,select:e,clearSelection:t},children:n})}function V(){const n=a.useContext(Ne);if(!n)throw new Error("useSelection must be used within a SelectionProvider");return n}const de=100;function dt(){const[n,o]=a.useState([]),[s,e]=a.useState(-1),t=a.useMemo(()=>s>=0&&s<n.length?n[s]??null:null,[n,s]),r=s>0,l=s<n.length-1,c=a.useCallback((f,g)=>{o(y=>{const u=s,v=u>=0&&u<y.length?y[u]:null;if(v&&v.docId===f&&v.chunkIndex===g)return y;const w={docId:f,chunkIndex:g??null,timestamp:Date.now()},b=[...y.slice(0,u+1),w];if(b.length>de){const p=b.slice(b.length-de);return e(p.length-1),p}return e(b.length-1),b})},[s]),h=a.useCallback(()=>{if(s<=0)return null;const f=s-1;return e(f),n[f]??null},[s,n]),m=a.useCallback(()=>{if(s>=n.length-1)return null;const f=s+1;return e(f),n[f]??null},[s,n]);return{push:c,goBack:h,goForward:m,canGoBack:r,canGoForward:l,current:t,history:n,currentIndex:s}}function F(n,o){const[s,e]=a.useState(()=>{try{const r=window.localStorage.getItem(n);return r?JSON.parse(r):o}catch{return o}}),t=a.useCallback(r=>{e(l=>{const c=r instanceof Function?r(l):r;try{window.localStorage.setItem(n,JSON.stringify(c))}catch(h){console.warn(`Failed to persist "${n}" to localStorage:`,h)}return c})},[n]);return a.useEffect(()=>{const r=l=>{if(l.key===n&&l.newValue!==null)try{e(JSON.parse(l.newValue))}catch{}};return window.addEventListener("storage",r),()=>window.removeEventListener("storage",r)},[n]),[s,t]}function ue(n){const{storageKey:o,defaultWidth:s,min:e,max:t}=n,[r,l]=F(`ws-panel-${o}`,{width:s,collapsed:!1}),c=a.useCallback(f=>{const g=Math.max(e,Math.min(t,f));l(y=>({...y,width:g}))},[e,t,l]),h=a.useCallback(()=>{l(f=>({...f,collapsed:!f.collapsed}))},[l]),m=a.useCallback(f=>{l(g=>({...g,collapsed:f}))},[l]);return{width:r.width,collapsed:r.collapsed,setWidth:c,toggleCollapsed:h,setCollapsed:m}}function ut(n){const o=a.useRef(n);o.current=n,a.useEffect(()=>{function s(e){if(e.metaKey||e.ctrlKey)switch(e.key){case"[":e.preventDefault(),o.current.onToggleLeftRail?.();break;case"]":e.preventDefault(),o.current.onToggleRightRail?.();break;case"ArrowLeft":e.preventDefault(),o.current.onNavigateBack?.();break;case"ArrowRight":e.preventDefault(),o.current.onNavigateForward?.();break}}return document.addEventListener("keydown",s),()=>document.removeEventListener("keydown",s)},[])}const Pe="/api/v1",ht=3e4,ft=3e5;async function B(n,o,s=ht){const e=new AbortController,t=setTimeout(()=>e.abort(),s);try{const r=await fetch(`${Pe}${n}`,{headers:{"Content-Type":"application/json",...o?.headers},...o,signal:e.signal}),l=await r.json();if(!r.ok)throw new Error(l.error||"Request failed");return l}catch(r){throw r instanceof Error&&r.name==="AbortError"?new Error("Request timed out"):r}finally{clearTimeout(t)}}async function Ns(n,o){return(await B("/search",{method:"POST",body:JSON.stringify({query:n,limit:o})})).results}async function Ps(n){const o=new AbortController,s=setTimeout(()=>o.abort(),ft);try{const e=new FormData;e.append("file",n);const t=await fetch(`${Pe}/files/upload`,{method:"POST",body:e,signal:o.signal}),r=await t.json();if(!t.ok)throw new Error(r.error||"Upload failed");return r}catch(e){throw e instanceof Error&&e.name==="AbortError"?new Error("Upload timed out"):e}finally{clearTimeout(s)}}async function Rs(n,o,s){return B("/data",{method:"POST",body:JSON.stringify({content:n,metadata:{source:o,format:s}})})}async function Re(){return(await B("/files")).files}async function gt(n){await B("/files",{method:"DELETE",body:JSON.stringify(n)})}async function Ms(){return B("/status")}async function Me(n){const o=encodeURIComponent(n);return(await B(`/documents/chunks?filePath=${o}`)).chunks}async function mt(n,o,s){const e=new URLSearchParams({filePath:n,chunkIndex:String(o)});return(await B(`/chunks/related?${e.toString()}`)).related.map(r=>({...r,connectionReason:r.explanation?pt(r.explanation):De(r.score,r.filePath===n)}))}function pt(n){switch(n.reasonLabel){case"same_doc":return"Same document";case"very_similar":return"Very similar";case"related_topic":return"Related topic";case"loosely_related":return"Loosely related";default:return"Related"}}async function Ds(n,o){const s=await B("/chunks/batch-related",{method:"POST",body:JSON.stringify({chunks:n,limit:o})}),e={};for(const[t,r]of Object.entries(s.results)){const[l]=t.split(":");e[t]=r.map(c=>({...c,connectionReason:De(c.score,c.filePath===l)}))}return e}function De(n,o){return o?"Same document":n<.3?"Very similar":n<.5?"Related topic":"Loosely related"}async function he(n,o,s){await B("/feedback",{method:"POST",body:JSON.stringify({type:n,source:o,target:s})})}const bt={sm:"h-4 w-4",md:"h-5 w-5",lg:"h-8 w-8"};function xt({size:n="md",className:o="",style:s}){return i.jsxs("svg",{className:`animate-spin ${bt[n]} text-current ${o}`,style:s,fill:"none",viewBox:"0 0 24 24",role:"status","aria-label":"Loading",children:[i.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),i.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}const yt={success:{container:"ws-toast--success",icon:"ws-toast-icon--success"},error:{container:"ws-toast--error",icon:"ws-toast-icon--error"},info:{container:"ws-toast--info",icon:"ws-toast-icon--info"}};function wt({toast:n,onDismiss:o}){const s=yt[n.type],[e,t]=a.useState(!1),r=a.useRef(o);r.current=o,a.useEffect(()=>{const c=setTimeout(()=>{t(!0),setTimeout(()=>r.current(n.id),200)},5e3);return()=>clearTimeout(c)},[n.id]);const l=()=>{t(!0),setTimeout(()=>o(n.id),200)};return i.jsxs("div",{className:`ws-toast ${s.container} ${e?"ws-toast--exiting":""}`,role:"alert","aria-live":"polite",children:[i.jsxs("div",{className:`ws-toast-icon ${s.icon}`,children:[n.type==="success"&&i.jsx(kt,{}),n.type==="error"&&i.jsx(vt,{}),n.type==="info"&&i.jsx(St,{})]}),i.jsxs("div",{className:"ws-toast-content",children:[i.jsx("p",{className:"ws-toast-title",children:n.title}),n.message&&i.jsx("p",{className:"ws-toast-message",children:n.message})]}),i.jsx("button",{type:"button",onClick:l,className:"ws-toast-close","aria-label":"Dismiss",children:i.jsx(Ct,{})})]})}function kt(){return i.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}function vt(){return i.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}function St(){return i.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}function Ct(){return i.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}function It({toasts:n,onDismiss:o}){return i.jsx("div",{className:"ws-toast-container",children:n.map(s=>i.jsx(wt,{toast:s,onDismiss:o},s.id))})}const Oe=a.createContext(null);function jt({children:n}){const[o,s]=a.useState([]),e=a.useCallback(r=>{const l=`${Date.now()}-${Math.random().toString(36).slice(2,9)}`;s(c=>[...c,{...r,id:l}])},[]),t=a.useCallback(r=>{s(l=>l.filter(c=>c.id!==r))},[]);return i.jsxs(Oe.Provider,{value:{addToast:e,removeToast:t},children:[n,i.jsx(It,{toasts:o,onDismiss:t})]})}function _(){const n=a.useContext(Oe);if(!n)throw new Error("useToast must be used within a ToastProvider");return n}function Tt(){const n=q(),{addToast:o}=_(),{data:s=[],isLoading:e,error:t}=H({queryKey:["files"],queryFn:Re}),r=$({mutationFn:gt,onSuccess:()=>{n.invalidateQueries({queryKey:["files"]}),o({type:"success",title:"File deleted",message:"The file has been removed from the knowledge base."})},onError:l=>{o({type:"error",title:"Failed to delete file",message:l.message})}});return{files:s,isLoading:e,error:t,deleteFile:r.mutate,isDeleting:r.isPending}}function fe(n,o){if(!o)return!0;const s=n.toLowerCase(),e=o.toLowerCase();return s.includes(e)}function Et(){const[n,o]=a.useState(!1),[s,e]=a.useState(""),[t,r]=a.useState(0),{files:l}=Tt(),{select:c}=V(),h=tt(),m=a.useCallback(()=>{o(!0),e(""),r(0)},[]),f=a.useCallback(()=>{o(!1)},[]),g=a.useCallback(()=>{o(w=>(w||(e(""),r(0)),!w))},[]),y=a.useMemo(()=>{const w=l.map(p=>{const d=p.filePath.split("/").pop()||p.filePath;return{id:`doc:${p.filePath}`,label:d,description:p.filePath,icon:"D",category:"document",onSelect:()=>{c({docId:p.filePath,source:"command-palette"}),h(`/reader?doc=${encodeURIComponent(p.filePath)}`)}}}),k=[{id:"nav:search",label:"Search",description:"Go to search page",icon:"S",category:"navigation",onSelect:()=>h("/")},{id:"nav:upload",label:"Upload",description:"Go to upload page",icon:"U",category:"navigation",onSelect:()=>h("/upload")},{id:"nav:files",label:"Files",description:"Go to files page",icon:"F",category:"navigation",onSelect:()=>h("/files")},{id:"nav:collections",label:"Collections",description:"Go to collections page",icon:"C",category:"navigation",onSelect:()=>h("/collections")},{id:"nav:status",label:"Status",description:"Go to status page",icon:"T",category:"navigation",onSelect:()=>h("/status")},{id:"nav:settings",label:"Settings",description:"Go to settings page",icon:"G",category:"navigation",onSelect:()=>h("/settings")}],b=[{id:"action:toggle-left-rail",label:"Toggle left rail",description:"Show or hide the left sidebar",icon:"L",category:"action",onSelect:()=>{window.dispatchEvent(new CustomEvent("ws:toggle-left-rail"))}},{id:"action:toggle-right-rail",label:"Toggle right rail",description:"Show or hide the right sidebar",icon:"R",category:"action",onSelect:()=>{window.dispatchEvent(new CustomEvent("ws:toggle-right-rail"))}}];return[...w,...k,...b]},[l,c,h]),u=a.useMemo(()=>s?y.filter(w=>fe(w.label,s)||w.description&&fe(w.description,s)):y,[y,s]);a.useEffect(()=>{r(w=>u.length===0?0:Math.min(w,u.length-1))},[u.length]);const v=a.useCallback(()=>{const w=u[t];w&&(w.onSelect(),f())},[u,t,f]);return a.useEffect(()=>{function w(k){(k.metaKey||k.ctrlKey)&&k.key==="k"&&(k.preventDefault(),g())}return window.addEventListener("keydown",w),()=>window.removeEventListener("keydown",w)},[g]),{isOpen:n,open:m,close:f,toggle:g,query:s,setQuery:e,results:u,selectedIndex:t,setSelectedIndex:r,executeSelected:v}}function At(n){switch(n){case"document":return"Documents";case"navigation":return"Navigation";case"action":return"Actions"}}function Nt(){const{isOpen:n,close:o,query:s,setQuery:e,results:t,selectedIndex:r,setSelectedIndex:l,executeSelected:c}=Et(),h=a.useRef(null),m=a.useRef(null);a.useEffect(()=>{if(n){const u=requestAnimationFrame(()=>{h.current?.focus()});return()=>cancelAnimationFrame(u)}},[n]),a.useEffect(()=>{if(!n||!m.current)return;const u=m.current.querySelector('[data-selected="true"]');u&&u.scrollIntoView({block:"nearest"})},[r,n]);function f(u){switch(u.key){case"ArrowDown":u.preventDefault(),l(Math.min(r+1,t.length-1));break;case"ArrowUp":u.preventDefault(),l(Math.max(r-1,0));break;case"Enter":u.preventDefault(),c();break;case"Escape":u.preventDefault(),o();break}}if(!n)return null;const g=[],y=new Set;for(let u=0;u<t.length;u++){const v=t[u];y.has(v.category)||(y.add(v.category),g.push({category:v.category,items:[]})),g.find(k=>k.category===v.category)?.items.push({action:v,globalIndex:u})}return i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"ws-command-palette-backdrop",onClick:o,onKeyDown:u=>{u.key==="Escape"&&o()}}),i.jsxs("div",{className:"ws-command-palette",role:"dialog","aria-modal":"true","aria-label":"Command palette",onKeyDown:f,children:[i.jsx("input",{ref:h,className:"ws-command-palette-input ws-input",type:"text",placeholder:"Search documents, pages, actions...",value:s,onChange:u=>e(u.target.value),"aria-label":"Command palette search","aria-controls":"command-palette-results","aria-activedescendant":t[r]?`command-palette-item-${t[r].id}`:void 0,role:"combobox","aria-expanded":"true","aria-autocomplete":"list"}),i.jsxs("div",{ref:m,id:"command-palette-results",className:"ws-command-palette-results",role:"listbox","aria-label":"Command palette results",children:[t.length===0&&i.jsx("div",{className:"ws-command-palette-empty",children:"No results found"}),g.map(u=>i.jsxs("div",{className:"ws-command-palette-group",children:[i.jsx("div",{className:"ws-command-palette-category",children:At(u.category)}),u.items.map(({action:v,globalIndex:w})=>i.jsxs("button",{id:`command-palette-item-${v.id}`,className:`ws-command-palette-item ${w===r?"ws-command-palette-item--selected":""}`,role:"option","aria-selected":w===r,"data-selected":w===r,onClick:()=>{l(w),v.onSelect(),o()},onMouseEnter:()=>l(w),type:"button",children:[i.jsx("span",{className:"ws-command-palette-item-icon",children:v.icon}),i.jsxs("span",{className:"ws-command-palette-item-content",children:[i.jsx("span",{className:"ws-command-palette-item-label",children:v.label}),v.description&&i.jsx("span",{className:"ws-command-palette-item-description",children:v.description})]})]},v.id))]},u.category))]}),i.jsxs("div",{className:"ws-command-palette-footer",children:[i.jsxs("span",{className:"ws-command-palette-hint",children:[i.jsx("kbd",{children:"↑↓"})," navigate"]}),i.jsxs("span",{className:"ws-command-palette-hint",children:[i.jsx("kbd",{children:"Enter"})," select"]}),i.jsxs("span",{className:"ws-command-palette-hint",children:[i.jsx("kbd",{children:"Esc"})," close"]})]})]})]})}const Pt="modulepreload",Rt=function(n){return"/"+n},ge={},G=function(o,s,e){let t=Promise.resolve();if(s&&s.length>0){let h=function(m){return Promise.all(m.map(f=>Promise.resolve(f).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),c=l?.nonce||l?.getAttribute("nonce");t=h(s.map(m=>{if(m=Rt(m),m in ge)return;ge[m]=!0;const f=m.endsWith(".css"),g=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${g}`))return;const y=document.createElement("link");if(y.rel=f?"stylesheet":Pt,f||(y.as="script"),y.crossOrigin="",y.href=m,c&&y.setAttribute("nonce",c),document.head.appendChild(y),f)return new Promise((u,v)=>{y.addEventListener("load",u),y.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${m}`)))})}))}function r(l){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=l,window.dispatchEvent(c),!c.defaultPrevented)throw l}return t.then(l=>{for(const c of l||[])c.status==="rejected"&&r(c.reason);return o().catch(r)})},me=8;function pe(){const n=crypto.randomUUID();return{tabs:[{tabId:n,kind:"search",title:"Search",scrollTop:0,lastActiveAt:Date.now(),pinned:!0}],activeTabId:n}}function be(n,o){const s=n.filter(t=>!t.pinned&&t.tabId!==o);if(s.length===0)return n;let e=s[0];for(const t of s)t.lastActiveAt<e.lastActiveAt&&(e=t);return n.filter(t=>t.tabId!==e.tabId)}const Le=a.createContext(null);function Mt({dbId:n,children:o}){const s=`rag-vault-tabs-v1-${n}`,[e,t]=F(s,pe()),r=a.useCallback((u,v,w)=>{t(k=>{const b=k.tabs.find(x=>x.kind==="doc"&&x.docId===u);if(b)return{...k,activeTabId:b.tabId,tabs:k.tabs.map(x=>x.tabId===b.tabId?{...x,lastActiveAt:Date.now()}:x)};const p={tabId:crypto.randomUUID(),kind:"doc",docId:u,chunkRef:w,title:v,scrollTop:0,lastActiveAt:Date.now(),pinned:!1};let d=[...k.tabs,p];return d.length>me&&(d=be(d,p.tabId)),{tabs:d,activeTabId:p.tabId}})},[t]),l=a.useCallback((u,v)=>{t(w=>{const k=w.tabs.find(d=>d.kind===u);if(k)return{...w,activeTabId:k.tabId,tabs:w.tabs.map(d=>d.tabId===k.tabId?{...d,lastActiveAt:Date.now()}:d)};const b={tabId:crypto.randomUUID(),kind:u,title:v,scrollTop:0,lastActiveAt:Date.now(),pinned:!1};let p=[...w.tabs,b];return p.length>me&&(p=be(p,b.tabId)),{tabs:p,activeTabId:b.tabId}})},[t]),c=a.useCallback(u=>{t(v=>{const w=v.tabs.findIndex(p=>p.tabId===u);if(w===-1)return v;const k=v.tabs.filter(p=>p.tabId!==u);if(k.length===0)return pe();let b=v.activeTabId;if(v.activeTabId===u){const p=Math.min(w,k.length-1);b=k[p].tabId}return{tabs:k,activeTabId:b}})},[t]),h=a.useCallback(u=>{t(v=>({...v,activeTabId:u,tabs:v.tabs.map(w=>w.tabId===u?{...w,lastActiveAt:Date.now()}:w)}))},[t]),m=a.useCallback((u,v)=>{t(w=>({...w,tabs:w.tabs.map(k=>k.tabId===u?{...k,scrollTop:v}:k)}))},[t]),f=a.useCallback((u,v)=>{t(w=>({...w,tabs:w.tabs.map(k=>k.tabId===u?{...k,pinned:v}:k)}))},[t]),g=a.useMemo(()=>e.tabs.find(u=>u.tabId===e.activeTabId),[e.tabs,e.activeTabId]),y=a.useMemo(()=>({tabs:e.tabs,activeTabId:e.activeTabId,activeTab:g,openDoc:r,openPage:l,closeTab:c,setActiveTab:h,updateTabScroll:m,pinTab:f}),[e.tabs,e.activeTabId,g,r,l,c,h,m,f]);return i.jsx(Le.Provider,{value:y,children:o})}function Dt(){const n=a.useContext(Le);if(!n)throw new Error("useTabs must be used within a TabsProvider");return n}const Ot=a.forwardRef(({variant:n="default",size:o="md",className:s="",children:e,...t},r)=>i.jsx("button",{ref:r,"data-variant":n,"data-size":o,className:`ws-button ${s}`,...t,children:e}));Ot.displayName="WsButton";const Lt=a.forwardRef(({error:n,className:o="",...s},e)=>i.jsx("input",{ref:e,"data-error":n||void 0,className:`ws-input ${o}`,...s}));Lt.displayName="WsInput";const Ft=a.forwardRef(({error:n,className:o="",children:s,...e},t)=>i.jsx("select",{ref:t,"data-error":n||void 0,className:`ws-select ${o}`,...e,children:s}));Ft.displayName="WsSelect";function Fe({tabs:n,activeId:o,onSelect:s,onClose:e,variant:t="underline",className:r=""}){const l=a.useRef(null),c=h=>{const m=l.current?.querySelectorAll('[role="tab"]');if(!m?.length)return;const f=Array.from(m).indexOf(document.activeElement);let g=f;if(h.key==="ArrowRight"?(h.preventDefault(),g=f+1>=m.length?0:f+1):h.key==="ArrowLeft"&&(h.preventDefault(),g=f-1<0?m.length-1:f-1),g!==f){const y=m[g];if(y){y.focus();const u=y.dataset.tabId;u&&s(u)}}};return i.jsx("div",{ref:l,role:"tablist",className:`ws-tabs ws-tabs--${t} ${r}`,onKeyDown:c,children:n.map(h=>{const m=h.id===o;return i.jsxs("button",{role:"tab",type:"button","aria-selected":m,tabIndex:m?0:-1,"data-tab-id":h.id,className:"ws-tab",onClick:()=>s(h.id),children:[h.icon&&i.jsx("span",{className:"ws-tab-icon",children:h.icon}),h.label,h.badge!==void 0&&i.jsx("span",{className:"ws-tab-badge",children:h.badge}),h.closeable&&!h.pinned&&i.jsx("span",{role:"button",tabIndex:-1,className:"ws-tab-close",onClick:f=>{f.stopPropagation(),e?.(h.id)},onKeyDown:f=>{(f.key==="Enter"||f.key===" ")&&(f.stopPropagation(),e?.(h.id))},children:"x"})]},h.id)})})}function oe({variant:n="default",count:o,children:s,className:e="",...t}){return i.jsxs("span",{"data-variant":n,className:`ws-badge ${e}`,...t,children:[s,o!==void 0&&i.jsx("span",{className:"ws-badge-count",children:o})]})}function $t({content:n,side:o="top",delay:s=300,children:e}){const[t,r]=a.useState(!1),l=a.useRef(null),c=a.useCallback(()=>{l.current=setTimeout(()=>r(!0),s)},[s]),h=a.useCallback(()=>{l.current&&(clearTimeout(l.current),l.current=null),r(!1)},[]);return a.useEffect(()=>()=>{l.current&&clearTimeout(l.current)},[]),i.jsxs("span",{className:"ws-tooltip-anchor",onMouseEnter:c,onMouseLeave:h,onFocus:c,onBlur:h,children:[e,t&&i.jsx("span",{className:`ws-tooltip ws-tooltip--${o}`,role:"tooltip",children:n})]})}function _t(){const{tabs:n,activeTabId:o,setActiveTab:s,closeTab:e}=Dt(),t=n.map(r=>({id:r.tabId,label:r.title,closeable:!r.pinned,pinned:r.pinned}));return i.jsx("div",{className:"ws-tab-bar",children:i.jsx(Fe,{tabs:t,activeId:o,onSelect:s,onClose:e,variant:"pill"})})}const Kt=a.lazy(()=>G(()=>import("./ReaderPage-CwMN03NU.js"),__vite__mapDeps([0,1,2,3,4])).then(n=>({default:n.ReaderPage}))),zt=a.lazy(()=>G(()=>import("./SearchPage-DAltjnLL.js"),__vite__mapDeps([5,1,3])).then(n=>({default:n.SearchPage}))),Wt=a.lazy(()=>G(()=>import("./UploadPage-eyfSjL4u.js"),__vite__mapDeps([6,1,3])).then(n=>({default:n.UploadPage}))),qt=a.lazy(()=>G(()=>import("./FilesPage-pG9HmpgQ.js"),__vite__mapDeps([7,1,3])).then(n=>({default:n.FilesPage}))),Bt=a.lazy(()=>G(()=>import("./CollectionsPage-BDmEfv3V.js"),__vite__mapDeps([8,1,4,3])).then(n=>({default:n.CollectionsPage}))),Ut=a.lazy(()=>G(()=>import("./StatusPage-powRGmW3.js"),__vite__mapDeps([9,1,10,3])).then(n=>({default:n.StatusPage}))),Ht=a.lazy(()=>G(()=>import("./SettingsPage-C6J5BITP.js"),__vite__mapDeps([11,1,10,4,3])).then(n=>({default:n.SettingsPage}))),Vt=a.lazy(()=>G(()=>import("./ReaderSettingsContext-CkSjqsRh.js"),__vite__mapDeps([2,1,3])).then(n=>({default:n.ReaderSettingsProvider})));function xe(){return i.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:i.jsx(xt,{})})}function Gt(){return i.jsxs("div",{className:"ws-center-pane",children:[i.jsx(_t,{}),i.jsx("div",{className:"ws-center-content",children:i.jsx(a.Suspense,{fallback:i.jsx(xe,{}),children:i.jsxs(nt,{children:[i.jsx(J,{path:"/",element:i.jsx(zt,{})}),i.jsx(J,{path:"/read",element:i.jsx(a.Suspense,{fallback:i.jsx(xe,{}),children:i.jsx(Vt,{children:i.jsx(Kt,{})})})}),i.jsx(J,{path:"/upload",element:i.jsx(Wt,{})}),i.jsx(J,{path:"/files",element:i.jsx(qt,{})}),i.jsx(J,{path:"/collections",element:i.jsx(Bt,{})}),i.jsx(J,{path:"/status",element:i.jsx(Ut,{})}),i.jsx(J,{path:"/settings",element:i.jsx(Ht,{})})]})})})]})}const Jt={theme:"system",lastBrowsedPath:"/",showHiddenFiles:!1,statsRefreshInterval:0},$e=a.createContext(null);function Qt(){return typeof window>"u"?"light":window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function Xt({children:n}){const[o,s]=F("rag-vault-preferences",Jt),e=o.theme==="system"?Qt():o.theme;a.useEffect(()=>{const h=document.documentElement;e==="dark"?h.classList.add("dark"):h.classList.remove("dark")},[e]),a.useEffect(()=>{if(o.theme!=="system")return;const h=window.matchMedia("(prefers-color-scheme: dark)"),m=()=>{const f=document.documentElement;h.matches?f.classList.add("dark"):f.classList.remove("dark")};return h.addEventListener("change",m),()=>h.removeEventListener("change",m)},[o.theme]);const t=a.useCallback(h=>{s(m=>({...m,theme:h}))},[s]),r=a.useCallback(h=>{s(m=>({...m,lastBrowsedPath:h}))},[s]),l=a.useCallback(h=>{s(m=>({...m,showHiddenFiles:h}))},[s]),c=a.useCallback(h=>{s(m=>({...m,statsRefreshInterval:h}))},[s]);return i.jsx($e.Provider,{value:{preferences:o,setTheme:t,setLastBrowsedPath:r,setShowHiddenFiles:l,setStatsRefreshInterval:c,effectiveTheme:e},children:n})}function Os(){const n=a.useContext($e);if(!n)throw new Error("usePreferences must be used within a PreferencesProvider");return n}const Yt="/api/v1/config",Zt=3e4;async function O(n,o,s=Zt){const e=new AbortController,t=setTimeout(()=>e.abort(),s);try{const r=await fetch(`${Yt}${n}`,{headers:{"Content-Type":"application/json",...o?.headers},...o,signal:e.signal}),l=await r.json();if(!r.ok)throw new Error(l.error||"Request failed");return l}catch(r){throw r instanceof Error&&r.name==="AbortError"?new Error("Request timed out"):r}finally{clearTimeout(t)}}async function en(){return O("/current")}async function tn(){return(await O("/databases")).databases}async function nn(n){return(await O("/databases/switch",{method:"POST",body:JSON.stringify({dbPath:n})})).config}async function sn(n,o,s){return(await O("/databases/create",{method:"POST",body:JSON.stringify({dbPath:n,name:o,modelName:s})})).config}async function on(n){return(await O("/databases/scan",{method:"POST",body:JSON.stringify({scanPath:n})})).databases}async function rn(n,o=!1){return(await O("/databases",{method:"DELETE",body:JSON.stringify({dbPath:n,deleteFiles:o})})).databases}async function an(){return O("/allowed-roots")}async function ln(n){return O("/allowed-roots",{method:"POST",body:JSON.stringify({path:n})})}async function cn(n){return O("/allowed-roots",{method:"DELETE",body:JSON.stringify({path:n})})}async function dn(n,o=!1){const s=new URLSearchParams({path:n});return o&&s.set("showHidden","true"),O(`/browse?${s.toString()}`)}async function un(){return(await O("/models")).models}async function hn(){return O("/export")}async function fn(n){return O("/import",{method:"POST",body:JSON.stringify({config:n})})}async function gn(){return(await O("/hybrid-weight")).weight}async function mn(n){await O("/hybrid-weight",{method:"PUT",body:JSON.stringify({weight:n})})}function pn(n=0){const{data:o,isLoading:s,error:e,refetch:t,isFetching:r}=H({queryKey:["config","current"],queryFn:en,refetchInterval:n>0?n:!1});return{config:o,isLoading:s,error:e,refetch:t,isFetching:r}}function Ls(){const{data:n,isLoading:o,error:s,refetch:e}=H({queryKey:["config","databases"],queryFn:tn});return{databases:n||[],isLoading:o,error:s,refetch:e}}function Fs(){const n=q(),{addToast:o}=_(),s=$({mutationFn:e=>nn(e),onSuccess:(e,t)=>{n.invalidateQueries({queryKey:["config"]}),n.invalidateQueries({queryKey:["files"]}),n.invalidateQueries({queryKey:["status"]}),o({type:"success",title:"Database switched",message:`Now using ${t.split("/").pop()||t}`})},onError:e=>{o({type:"error",title:"Failed to switch database",message:e.message})}});return{switchDatabase:s.mutate,switchDatabaseAsync:s.mutateAsync,isLoading:s.isPending,error:s.error,isSuccess:s.isSuccess}}function $s(){const n=q(),{addToast:o}=_(),s=$({mutationFn:({dbPath:e,name:t,modelName:r})=>sn(e,t,r),onSuccess:(e,t)=>{n.invalidateQueries({queryKey:["config"]}),n.invalidateQueries({queryKey:["files"]}),n.invalidateQueries({queryKey:["status"]}),o({type:"success",title:"Database created",message:`Created and switched to ${t.dbPath.split("/").pop()||t.dbPath}`})},onError:e=>{o({type:"error",title:"Failed to create database",message:e.message})}});return{createDatabase:s.mutate,createDatabaseAsync:s.mutateAsync,isLoading:s.isPending,error:s.error,isSuccess:s.isSuccess}}function _s(){const{addToast:n}=_(),o=$({mutationFn:s=>on(s),onError:s=>{n({type:"error",title:"Scan failed",message:s.message})}});return{scan:o.mutate,scanAsync:o.mutateAsync,isLoading:o.isPending,error:o.error,data:o.data,reset:o.reset}}function Ks(){const n=q(),{addToast:o}=_(),s=$({mutationFn:({dbPath:e,deleteFiles:t})=>rn(e,t),onSuccess:(e,t)=>{n.invalidateQueries({queryKey:["config","databases"]});const r=t.dbPath.split("/").pop()||t.dbPath;o({type:"success",title:"Database removed",message:t.deleteFiles?`Deleted ${r} and its files`:`Removed ${r} from list`})},onError:e=>{o({type:"error",title:"Failed to delete database",message:e.message})}});return{deleteDatabase:s.mutate,deleteDatabaseAsync:s.mutateAsync,isLoading:s.isPending,error:s.error}}function zs(){const{data:n,isLoading:o,error:s,refetch:e}=H({queryKey:["config","allowed-roots"],queryFn:an});return{data:n,isLoading:o,error:s,refetch:e}}function Ws(){const n=q(),{addToast:o}=_(),s=$({mutationFn:e=>ln(e),onSuccess:()=>{n.invalidateQueries({queryKey:["config","allowed-roots"]}),o({type:"success",title:"Root added",message:"Allowed root added successfully"})},onError:e=>{o({type:"error",title:"Failed to add root",message:e.message})}});return{addRoot:s.mutate,addRootAsync:s.mutateAsync,isLoading:s.isPending,error:s.error}}function qs(){const n=q(),{addToast:o}=_(),s=$({mutationFn:e=>cn(e),onSuccess:()=>{n.invalidateQueries({queryKey:["config","allowed-roots"]}),o({type:"success",title:"Root removed",message:"Allowed root removed successfully"})},onError:e=>{o({type:"error",title:"Failed to remove root",message:e.message})}});return{removeRoot:s.mutate,removeRootAsync:s.mutateAsync,isLoading:s.isPending,error:s.error}}function Bs(){const{addToast:n}=_(),o=$({mutationFn:({path:t,showHidden:r=!1})=>dn(t,r),onError:t=>{n({type:"error",title:"Failed to browse directory",message:t.message})}}),s=a.useCallback((t,r=!1)=>o.mutate({path:t,showHidden:r}),[o.mutate]),e=a.useCallback((t,r=!1)=>o.mutateAsync({path:t,showHidden:r}),[o.mutateAsync]);return{browse:s,browseAsync:e,isLoading:o.isPending,error:o.error,data:o.data,reset:o.reset}}function Us(){const{data:n,isLoading:o,error:s}=H({queryKey:["config","models"],queryFn:un});return{models:n||[],isLoading:o,error:s}}function Hs(){const{addToast:n}=_(),o=$({mutationFn:hn,onSuccess:()=>{n({type:"success",title:"Configuration exported",message:"Download should begin automatically"})},onError:s=>{n({type:"error",title:"Failed to export configuration",message:s.message})}});return{exportConfig:o.mutate,exportConfigAsync:o.mutateAsync,isLoading:o.isPending,error:o.error,data:o.data}}function Vs(){const n=q(),{addToast:o}=_(),s=$({mutationFn:e=>fn(e),onSuccess:()=>{n.invalidateQueries({queryKey:["config","allowed-roots"]}),o({type:"success",title:"Configuration imported",message:"Settings have been restored"})},onError:e=>{o({type:"error",title:"Failed to import configuration",message:e.message})}});return{importConfig:s.mutate,importConfigAsync:s.mutateAsync,isLoading:s.isPending,error:s.error}}function Gs(){const{data:n,isLoading:o,error:s,refetch:e}=H({queryKey:["config","hybrid-weight"],queryFn:gn});return{weight:n??.6,isLoading:o,error:s,refetch:e}}function Js(){const n=q(),{addToast:o}=_(),s=$({mutationFn:e=>mn(e),onSuccess:()=>{n.invalidateQueries({queryKey:["config","hybrid-weight"]}),o({type:"success",title:"Search weight updated",message:"Hybrid search weight has been adjusted"})},onError:e=>{o({type:"error",title:"Failed to update search weight",message:e.message})}});return{setWeight:s.mutate,setWeightAsync:s.mutateAsync,isLoading:s.isPending,error:s.error}}function bn(n){const{data:o=[],isLoading:s,error:e,refetch:t}=H({queryKey:["documentChunks",n],queryFn:()=>n?Me(n):Promise.resolve([]),enabled:!!n,staleTime:3e5});return{chunks:o,isLoading:s,error:e,refetch:t}}function _e(n,o,s){const{data:e=[],isLoading:t,error:r,refetch:l}=H({queryKey:["relatedChunks",n,o,s],queryFn:()=>n&&o!==null?mt(n,o):Promise.resolve([]),enabled:!!n&&o!==null,staleTime:3e5});return{related:e,isLoading:t,error:r,refetch:l}}function te(){return crypto.randomUUID()}async function ye(n){const s=new TextEncoder().encode(n),e=await crypto.subtle.digest("SHA-256",s);return Array.from(new Uint8Array(e)).map(r=>r.toString(16).padStart(2,"0")).join("")}function Q(n,o){return n.fingerprint&&o.fingerprint?n.fingerprint===o.fingerprint:n.filePath===o.filePath&&n.chunkIndex===o.chunkIndex}const xn={version:1,vaultId:"",pins:[],trails:[],bookmarks:[]},Ke=a.createContext(null);function yn({children:n,vaultId:o="default"}){const s=`rag-vault-links-v1-${o}`,[e,t]=F(s,{...xn,vaultId:o}),r=a.useCallback((P,E,C,I,N)=>{const T={id:te(),createdAt:new Date().toISOString(),sourceKey:P,sourceText:C.slice(0,200),sourceFingerprint:"",targetKey:E,targetText:I.slice(0,200),targetFingerprint:"",label:N?.label,autoGenerated:N?.autoGenerated??!1,originalScore:N?.originalScore};return Promise.all([ye(C),ye(I)]).then(([R,D])=>{t(W=>({...W,pins:W.pins.map(Y=>Y.id===T.id?{...Y,sourceFingerprint:R,targetFingerprint:D}:Y)})),he("pin",{...P,fingerprint:R},{...E,fingerprint:D}).catch(()=>{})}).catch(R=>{console.warn("Failed to hash text for pin fingerprints:",R)}),t(R=>({...R,pins:[...R.pins,T]})),T},[t]),l=a.useCallback(P=>{const E=e.pins.find(C=>C.id===P);t(C=>({...C,pins:C.pins.filter(I=>I.id!==P)})),E&&he("unpin",{...E.sourceKey,fingerprint:E.sourceFingerprint},{...E.targetKey,fingerprint:E.targetFingerprint}).catch(()=>{})},[t,e.pins]),c=a.useCallback((P,E)=>{t(C=>({...C,pins:C.pins.map(I=>I.id===P?{...I,label:E}:I)}))},[t]),h=a.useCallback(P=>e.pins.filter(E=>Q(E.sourceKey,P)),[e.pins]),m=a.useCallback(P=>e.pins.filter(E=>Q(E.targetKey,P)),[e.pins]),f=a.useCallback((P,E)=>e.pins.some(C=>Q(C.sourceKey,P)&&Q(C.targetKey,E)),[e.pins]),[g,y]=F(`rag-vault-current-trail-${o}`,null),u=a.useCallback(()=>{const P={id:te(),name:"",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),steps:[]};y(P)},[y]),v=a.useCallback((P,E)=>{y(C=>{if(!C)return{id:te(),name:"",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),steps:[{chunkKey:P,visitedAt:new Date().toISOString(),connectionReason:E}]};const I=C.steps[C.steps.length-1];return I&&Q(I.chunkKey,P)?C:{...C,updatedAt:new Date().toISOString(),steps:[...C.steps,{chunkKey:P,visitedAt:new Date().toISOString(),connectionReason:E}]}})},[y]),w=a.useCallback(P=>{if(!g)throw new Error("No current trail to save");const E={...g,name:P,updatedAt:new Date().toISOString()};return t(C=>({...C,trails:[...C.trails,E]})),y(null),E},[g,t,y]),k=a.useCallback(P=>{const E=e.trails.find(C=>C.id===P);return E&&y({...E}),E||null},[e.trails,y]),b=a.useCallback(P=>{t(E=>({...E,trails:E.trails.filter(C=>C.id!==P)}))},[t]),p=a.useCallback(()=>{y(null)},[y]),d=a.useCallback((P,E)=>{const C={id:te(),chunkKey:P,note:E,createdAt:new Date().toISOString()};return t(I=>({...I,bookmarks:[...I.bookmarks||[],C]})),C},[t]),x=a.useCallback(P=>{t(E=>({...E,bookmarks:(E.bookmarks||[]).filter(C=>C.id!==P)}))},[t]),S=a.useCallback((P,E)=>{t(C=>({...C,bookmarks:(C.bookmarks||[]).map(I=>I.id===P?{...I,note:E}:I)}))},[t]),j=a.useCallback(P=>(e.bookmarks||[]).filter(E=>E.chunkKey.filePath===P).sort((E,C)=>E.chunkKey.chunkIndex-C.chunkKey.chunkIndex),[e.bookmarks]),A=a.useCallback(P=>(e.bookmarks||[]).some(E=>Q(E.chunkKey,P)),[e.bookmarks]),M=a.useCallback(P=>{const E=(e.bookmarks||[]).find(C=>Q(C.chunkKey,P));return E?(x(E.id),!1):(d(P),!0)},[e.bookmarks,d,x]),K=a.useCallback(()=>JSON.stringify(e,null,2),[e]),z=a.useCallback(P=>{const E=[];let C=0;try{const I=JSON.parse(P);if(I.version!==1)return E.push(`Unsupported version: ${I.version}`),{imported:C,errors:E};if(Array.isArray(I.pins))for(const N of I.pins)N.id&&N.sourceKey&&N.targetKey&&!e.pins.some(T=>T.id===N.id)&&(t(T=>({...T,pins:[...T.pins,N]})),C++);if(Array.isArray(I.trails))for(const N of I.trails)N.id&&N.name&&Array.isArray(N.steps)&&!e.trails.some(T=>T.id===N.id)&&(t(T=>({...T,trails:[...T.trails,N]})),C++);if(Array.isArray(I.bookmarks))for(const N of I.bookmarks)N.id&&N.chunkKey&&!(e.bookmarks||[]).some(T=>T.id===N.id)&&(t(T=>({...T,bookmarks:[...T.bookmarks||[],N]})),C++)}catch(I){E.push(`Invalid JSON: ${I.message}`)}return{imported:C,errors:E}},[e,t]),U=a.useMemo(()=>({pins:e.pins,createPin:r,deletePin:l,updatePinLabel:c,getPinsFromChunk:h,getBacklinks:m,isPinned:f,trails:e.trails,currentTrail:g,startNewTrail:u,addToTrail:v,saveTrail:w,loadTrail:k,deleteTrail:b,clearCurrentTrail:p,bookmarks:e.bookmarks||[],createBookmark:d,deleteBookmark:x,updateBookmarkNote:S,getBookmarksForDocument:j,isBookmarked:A,toggleBookmark:M,exportLinks:K,importLinks:z}),[e.pins,e.trails,e.bookmarks,r,l,c,h,m,f,g,u,v,w,k,b,p,d,x,S,j,A,M,K,z]);return i.jsx(Ke.Provider,{value:U,children:n})}function ze(){const n=a.useContext(Ke);if(!n)throw new Error("useLinks must be used within a LinksProvider");return n}function wn(){const n=ze(),o=a.useMemo(()=>{const e=new Set;for(const t of n.pins)e.add(`${t.targetKey.filePath}:${t.targetKey.chunkIndex}`);return e},[n.pins]),s=a.useCallback((e,t,r,l,c)=>{const h=n.pins.find(m=>m.sourceKey.filePath===e.filePath&&m.sourceKey.chunkIndex===e.chunkIndex&&m.targetKey.filePath===t.filePath&&m.targetKey.chunkIndex===t.chunkIndex);h?n.deletePin(h.id):n.createPin(e,t,r,l,{autoGenerated:!1,originalScore:c})},[n]);return{pins:n.pins,pinnedChunkKeys:o,createPin:n.createPin,deletePin:n.deletePin,updatePinLabel:n.updatePinLabel,isPinned:n.isPinned,togglePin:s,getPinsFromChunk:n.getPinsFromChunk}}function kn(n,o){const s=ze(),e=a.useMemo(()=>!n||o===null?[]:s.getBacklinks({filePath:n,chunkIndex:o}),[s,n,o]);return{backlinks:e,hasBacklinks:e.length>0,backlinkCount:e.length}}const vn=/^(#{1,6})\s+(.+)$/m,Sn=/^([A-Z][A-Z0-9\s]{4,79})$/m,Cn=/^(\d+(?:\.\d+)*)\s+(.+)$/m;function In(n){const o=n.match(vn);if(o){const[,t,r]=o;if(t&&r)return{text:r.trim(),level:t.length,type:"markdown"}}const s=n.match(Cn);if(s){const[,t,r]=s;if(t&&r){const l=t.split(".").length;return{text:`${t} ${r.trim()}`,level:l,type:"numbered"}}}const e=n.trim();if(e.length>=5&&e.length<=80){const t=e.match(Sn);if(t?.[1]){const r=t[1].match(/[A-Z]/g);if(r&&r.length>=3)return{text:t[1].trim(),level:1,type:"allcaps"}}}return null}function jn(n,o){const s=[],e=n.split(`
`);for(const t of e){const r=In(t);r&&s.push({...r,chunkIndex:o,text:r.text.length>80?`${r.text.slice(0,77)}...`:r.text})}return s}function Tn(n){const o=Math.max(1,Math.floor(n.length/10));return n.filter((s,e)=>e%o===0).map((s,e)=>({id:`fallback-${s.chunkIndex}`,text:`Section ${e+1}`,level:1,chunkIndex:s.chunkIndex,type:"fallback"}))}function En({chunks:n,minHeadings:o=2}){return a.useMemo(()=>{if(n.length===0)return{entries:[],hasHeadings:!1,isFallback:!1};const e=[];for(const l of n){const c=jn(l.text,l.chunkIndex);e.push(...c)}const t=[];for(const l of e){const c=t[t.length-1];(!c||c.text!==l.text||c.chunkIndex!==l.chunkIndex)&&t.push(l)}return t.length<o?{entries:Tn(n),hasHeadings:!1,isFallback:!0}:{entries:t.map((l,c)=>({...l,id:`toc-${c}-${l.chunkIndex}`})),hasHeadings:!0,isFallback:!1}},[n,o])}function we(){return crypto.randomUUID()}function An(n,o){return n.filePath===o.filePath&&n.chunkIndex===o.chunkIndex}const Nn={version:1,vaultId:"",highlights:[],annotations:[]},We=a.createContext(null);function Pn({children:n,vaultId:o="default"}){const s=`rag-vault-annotations-v1-${o}`,[e,t]=F(s,{...Nn,vaultId:o}),r=a.useCallback((k,b,p,d,x,S)=>{const j={id:we(),chunkKey:k,range:b,text:p,contextBefore:d.slice(-30),contextAfter:x.slice(0,30),color:S,createdAt:new Date().toISOString()};return t(A=>({...A,highlights:[...A.highlights,j]})),j},[t]),l=a.useCallback(k=>{t(b=>({...b,highlights:b.highlights.filter(p=>p.id!==k),annotations:b.annotations.filter(p=>p.highlightId!==k)}))},[t]),c=a.useCallback((k,b)=>{t(p=>({...p,highlights:p.highlights.map(d=>d.id===k?{...d,color:b}:d)}))},[t]),h=a.useCallback(k=>e.highlights.filter(b=>An(b.chunkKey,k)).sort((b,p)=>b.range.startOffset-p.range.startOffset),[e.highlights]),m=a.useCallback((k,b)=>{const p={id:we(),highlightId:k,note:b,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return t(d=>({...d,annotations:[...d.annotations,p]})),p},[t]),f=a.useCallback((k,b)=>{t(p=>({...p,annotations:p.annotations.map(d=>d.id===k?{...d,note:b,updatedAt:new Date().toISOString()}:d)}))},[t]),g=a.useCallback(k=>{t(b=>({...b,annotations:b.annotations.filter(p=>p.id!==k)}))},[t]),y=a.useCallback(k=>e.annotations.find(b=>b.highlightId===k),[e.annotations]),u=a.useCallback(()=>JSON.stringify(e,null,2),[e]),v=a.useCallback(k=>{const b=[];let p=0;try{const d=JSON.parse(k);if(d.version!==1)return b.push(`Unsupported version: ${d.version}`),{imported:p,errors:b};if(Array.isArray(d.highlights))for(const x of d.highlights)x.id&&x.chunkKey&&x.range&&!e.highlights.some(S=>S.id===x.id)&&(t(S=>({...S,highlights:[...S.highlights,x]})),p++);if(Array.isArray(d.annotations))for(const x of d.annotations)x.id&&x.highlightId&&!e.annotations.some(S=>S.id===x.id)&&(t(S=>({...S,annotations:[...S.annotations,x]})),p++)}catch(d){b.push(`Invalid JSON: ${d.message}`)}return{imported:p,errors:b}},[e,t]),w=a.useMemo(()=>({highlights:e.highlights,createHighlight:r,deleteHighlight:l,updateHighlightColor:c,getHighlightsForChunk:h,annotations:e.annotations,createAnnotation:m,updateAnnotation:f,deleteAnnotation:g,getAnnotationForHighlight:y,exportAnnotations:u,importAnnotations:v}),[e.highlights,e.annotations,r,l,c,h,m,f,g,y,u,v]);return i.jsx(We.Provider,{value:w,children:n})}function Qs(){const n=a.useContext(We);if(!n)throw new Error("useAnnotations must be used within an AnnotationsProvider");return n}function Rn({filePath:n,activeChunkIndex:o,relatedChunks:s,pins:e,maxNodes:t=150}){const r=a.useMemo(()=>{const c=new Map,h=[],m=o!==null?`${n}:${o}`:null;m&&c.set(m,{id:m,filePath:n,chunkIndex:o,text:"(current chunk)"});for(const u of s){const v=`${u.filePath}:${u.chunkIndex}`;c.has(v)||c.set(v,{id:v,filePath:u.filePath,chunkIndex:u.chunkIndex,text:u.text.slice(0,100)+(u.text.length>100?"...":"")}),m&&m!==v&&h.push({source:m,target:v,score:u.score,type:"semantic",label:u.connectionReason})}for(const u of e){const v=`${u.sourceKey.filePath}:${u.sourceKey.chunkIndex}`,w=`${u.targetKey.filePath}:${u.targetKey.chunkIndex}`;c.has(v)||c.set(v,{id:v,filePath:u.sourceKey.filePath,chunkIndex:u.sourceKey.chunkIndex,text:u.sourceText.slice(0,100)+(u.sourceText.length>100?"...":"")}),c.has(w)||c.set(w,{id:w,filePath:u.targetKey.filePath,chunkIndex:u.targetKey.chunkIndex,text:u.targetText.slice(0,100)+(u.targetText.length>100?"...":"")});const k=h.findIndex(b=>b.source===v&&b.target===w);if(k>=0){const b=h[k];b&&(h[k]={...b,type:"pinned",label:u.label||b.label})}else h.push({source:v,target:w,score:u.originalScore??.5,type:"pinned",label:u.label})}let f=Array.from(c.values());if(f.length>t){const u=new Set(e.flatMap(b=>[`${b.sourceKey.filePath}:${b.sourceKey.chunkIndex}`,`${b.targetKey.filePath}:${b.targetKey.chunkIndex}`])),v=f.filter(b=>b.id===m||u.has(b.id)),w=Math.max(0,t-v.length),k=f.filter(b=>b.id!==m&&!u.has(b.id)).slice(0,w);f=v.concat(k)}const g=new Set(f.map(u=>u.id)),y=h.filter(u=>g.has(u.source)&&g.has(u.target));return{nodes:f,edges:y}},[n,o,s,e,t]),l=o!==null?`${n}:${o}`:null;return{graphData:r,currentNodeId:l}}function ke(){return crypto.randomUUID()}const Mn={version:1,vaultId:"",updatedAt:new Date().toISOString(),tags:[],taggedItems:[]},Xs={red:{bg:"bg-red-100 dark:bg-red-900/40",text:"text-red-700 dark:text-red-300",border:"border-red-200 dark:border-red-800"},orange:{bg:"bg-orange-100 dark:bg-orange-900/40",text:"text-orange-700 dark:text-orange-300",border:"border-orange-200 dark:border-orange-800"},yellow:{bg:"bg-yellow-100 dark:bg-yellow-900/40",text:"text-yellow-700 dark:text-yellow-300",border:"border-yellow-200 dark:border-yellow-800"},green:{bg:"bg-green-100 dark:bg-green-900/40",text:"text-green-700 dark:text-green-300",border:"border-green-200 dark:border-green-800"},blue:{bg:"bg-blue-100 dark:bg-blue-900/40",text:"text-blue-700 dark:text-blue-300",border:"border-blue-200 dark:border-blue-800"},purple:{bg:"bg-purple-100 dark:bg-purple-900/40",text:"text-purple-700 dark:text-purple-300",border:"border-purple-200 dark:border-purple-800"},pink:{bg:"bg-pink-100 dark:bg-pink-900/40",text:"text-pink-700 dark:text-pink-300",border:"border-pink-200 dark:border-pink-800"},gray:{bg:"bg-gray-100 dark:bg-gray-700",text:"text-gray-700 dark:text-gray-300",border:"border-gray-200 dark:border-gray-600"}},qe=a.createContext(null);function Dn({children:n,vaultId:o="default"}){const s=`rag-vault-tags-v1-${o}`,[e,t]=F(s,{...Mn,vaultId:o}),r=a.useCallback((d,x)=>{const S={id:ke(),name:d.trim(),color:x,usageCount:0,lastUsedAt:new Date().toISOString(),createdAt:new Date().toISOString()};return t(j=>({...j,updatedAt:new Date().toISOString(),tags:[...j.tags,S]})),S},[t]),l=a.useCallback((d,x)=>{t(S=>({...S,updatedAt:new Date().toISOString(),tags:S.tags.map(j=>{if(j.id!==d)return j;const A={...x};return A.name!==void 0&&(A.name=A.name.trim()),{...j,...A}})}))},[t]),c=a.useCallback(d=>{t(x=>({...x,updatedAt:new Date().toISOString(),tags:x.tags.filter(S=>S.id!==d),taggedItems:x.taggedItems.filter(S=>S.tagId!==d)}))},[t]),h=a.useCallback(d=>e.tags.find(x=>x.id===d),[e.tags]),m=a.useCallback((d,x,S)=>{const j={id:ke(),tagId:d,targetType:x,targetKey:S,createdAt:new Date().toISOString()};return t(A=>({...A,updatedAt:new Date().toISOString(),taggedItems:[...A.taggedItems,j],tags:A.tags.map(M=>M.id===d?{...M,usageCount:M.usageCount+1,lastUsedAt:new Date().toISOString()}:M)})),j},[t]),f=a.useCallback(d=>{t(x=>({...x,updatedAt:new Date().toISOString(),taggedItems:x.taggedItems.filter(S=>S.id!==d)}))},[t]),g=a.useCallback((d,x,S)=>{t(j=>({...j,updatedAt:new Date().toISOString(),taggedItems:j.taggedItems.filter(A=>!(A.tagId===d&&A.targetType===x&&A.targetKey===S))}))},[t]),y=a.useCallback((d,x)=>{const S=e.taggedItems.filter(j=>j.targetType===d&&j.targetKey===x).map(j=>j.tagId);return e.tags.filter(j=>S.includes(j.id))},[e.tags,e.taggedItems]),u=a.useCallback(d=>e.taggedItems.filter(x=>x.tagId===d),[e.taggedItems]),v=a.useCallback((d,x,S)=>e.taggedItems.some(j=>j.tagId===d&&j.targetType===x&&j.targetKey===S),[e.taggedItems]),w=a.useCallback((d=10)=>[...e.tags].sort((x,S)=>S.usageCount!==x.usageCount?S.usageCount-x.usageCount:new Date(S.lastUsedAt).getTime()-new Date(x.lastUsedAt).getTime()).slice(0,d),[e.tags]),k=a.useCallback(()=>JSON.stringify(e,null,2),[e]),b=a.useCallback(d=>{const x=[];let S=0;try{const j=JSON.parse(d);if(j.version!==1)return x.push(`Unsupported version: ${j.version}`),{imported:S,errors:x};if(Array.isArray(j.tags))for(const A of j.tags)A.id&&A.name&&!e.tags.some(M=>M.id===A.id)&&(t(M=>({...M,updatedAt:new Date().toISOString(),tags:[...M.tags,A]})),S++);if(Array.isArray(j.taggedItems))for(const A of j.taggedItems)A.id&&A.tagId&&A.targetKey&&!e.taggedItems.some(M=>M.id===A.id)&&(t(M=>({...M,updatedAt:new Date().toISOString(),taggedItems:[...M.taggedItems,A]})),S++)}catch(j){x.push(`Invalid JSON: ${j.message}`)}return{imported:S,errors:x}},[e,t]),p=a.useMemo(()=>({tags:e.tags,createTag:r,updateTag:l,deleteTag:c,getTag:h,taggedItems:e.taggedItems,addTag:m,removeTag:f,removeTagFromTarget:g,getTagsForTarget:y,getTargetsForTag:u,isTagged:v,getTagSuggestions:w,exportTags:k,importTags:b}),[e.tags,e.taggedItems,r,l,c,h,m,f,g,y,u,v,w,k,b]);return i.jsx(qe.Provider,{value:p,children:n})}function Ys(){const n=a.useContext(qe);if(!n)throw new Error("useTags must be used within a TagsProvider");return n}function On(){return crypto.randomUUID()}const Ln={version:1,vaultId:"",updatedAt:new Date().toISOString(),collections:[]},Zs=["red","orange","yellow","green","blue","purple","pink","gray"],eo={red:{bg:"bg-red-100 dark:bg-red-900/40",text:"text-red-700 dark:text-red-300",border:"border-red-200 dark:border-red-800"},orange:{bg:"bg-orange-100 dark:bg-orange-900/40",text:"text-orange-700 dark:text-orange-300",border:"border-orange-200 dark:border-orange-800"},yellow:{bg:"bg-yellow-100 dark:bg-yellow-900/40",text:"text-yellow-700 dark:text-yellow-300",border:"border-yellow-200 dark:border-yellow-800"},green:{bg:"bg-green-100 dark:bg-green-900/40",text:"text-green-700 dark:text-green-300",border:"border-green-200 dark:border-green-800"},blue:{bg:"bg-blue-100 dark:bg-blue-900/40",text:"text-blue-700 dark:text-blue-300",border:"border-blue-200 dark:border-blue-800"},purple:{bg:"bg-purple-100 dark:bg-purple-900/40",text:"text-purple-700 dark:text-purple-300",border:"border-purple-200 dark:border-purple-800"},pink:{bg:"bg-pink-100 dark:bg-pink-900/40",text:"text-pink-700 dark:text-pink-300",border:"border-pink-200 dark:border-pink-800"},gray:{bg:"bg-gray-100 dark:bg-gray-700",text:"text-gray-700 dark:text-gray-300",border:"border-gray-200 dark:border-gray-600"}},Be=a.createContext(null);function Fn({children:n,vaultId:o="default"}){const s=`rag-vault-collections-v1-${o}`,[e,t]=F(s,{...Ln,vaultId:o}),r=a.useCallback((b,p,d)=>{const x={id:On(),name:b.trim(),description:d?.trim(),color:p,documents:[],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return t(S=>({...S,updatedAt:new Date().toISOString(),collections:[...S.collections,x]})),x},[t]),l=a.useCallback((b,p)=>{t(d=>({...d,updatedAt:new Date().toISOString(),collections:d.collections.map(x=>x.id===b?{...x,...p,updatedAt:new Date().toISOString()}:x)}))},[t]),c=a.useCallback(b=>{t(p=>({...p,updatedAt:new Date().toISOString(),collections:p.collections.filter(d=>d.id!==b)}))},[t]),h=a.useCallback(b=>e.collections.find(p=>p.id===b),[e.collections]),m=a.useCallback((b,p)=>{t(d=>({...d,updatedAt:new Date().toISOString(),collections:d.collections.map(x=>x.id!==b||x.documents.includes(p)?x:{...x,documents:[...x.documents,p],updatedAt:new Date().toISOString()})}))},[t]),f=a.useCallback((b,p)=>{t(d=>({...d,updatedAt:new Date().toISOString(),collections:d.collections.map(x=>x.id!==b?x:{...x,documents:x.documents.filter(S=>S!==p),updatedAt:new Date().toISOString()})}))},[t]),g=a.useCallback(b=>e.collections.filter(p=>p.documents.includes(b)),[e.collections]),y=a.useCallback(b=>e.collections.find(d=>d.id===b)?.documents??[],[e.collections]),u=a.useCallback((b,p)=>e.collections.find(x=>x.id===b)?.documents.includes(p)??!1,[e.collections]),v=a.useCallback(()=>JSON.stringify(e,null,2),[e]),w=a.useCallback(b=>{const p=[];let d=0;try{const x=JSON.parse(b);if(x.version!==1)return p.push(`Unsupported version: ${x.version}`),{imported:d,errors:p};if(Array.isArray(x.collections))for(const S of x.collections)S.id&&S.name&&!e.collections.some(j=>j.id===S.id)&&(t(j=>({...j,updatedAt:new Date().toISOString(),collections:[...j.collections,S]})),d++)}catch(x){p.push(`Invalid JSON: ${x.message}`)}return{imported:d,errors:p}},[e,t]),k=a.useMemo(()=>({collections:e.collections,createCollection:r,updateCollection:l,deleteCollection:c,getCollection:h,addDocumentToCollection:m,removeDocumentFromCollection:f,getCollectionsForDocument:g,getDocumentsInCollection:y,isDocumentInCollection:u,exportCollections:v,importCollections:w}),[e.collections,r,l,c,h,m,f,g,y,u,v,w]);return i.jsx(Be.Provider,{value:k,children:n})}function to(){const n=a.useContext(Be);if(!n)throw new Error("useCollections must be used within a CollectionsProvider");return n}const re={pan:{x:0,y:0},zoom:1},ve={version:1,vaultId:"",nodePositions:{},viewState:re},$n=a.createContext(null);function _n({children:n,vaultId:o="default"}){const s=`rag-vault-graph-state-v1-${o}`,[e,t]=F(s,{...ve,vaultId:o}),r=a.useCallback(k=>e.nodePositions[k],[e.nodePositions]),l=a.useCallback((k,b)=>{t(p=>({...p,nodePositions:{...p.nodePositions,[k]:{x:b.x,y:b.y,fixedAt:new Date().toISOString()}}}))},[t]),c=a.useCallback(()=>{t(k=>({...k,nodePositions:{}}))},[t]),h=a.useCallback(k=>{t(b=>({...b,viewState:{...b.viewState,pan:k}}))},[t]),m=a.useCallback(k=>{t(b=>({...b,viewState:{...b.viewState,zoom:k}}))},[t]),f=a.useCallback(k=>{t(b=>({...b,viewState:k}))},[t]),g=a.useCallback(()=>{t(k=>({...k,viewState:re}))},[t]),y=a.useCallback(()=>{t(k=>({...ve,vaultId:k.vaultId}))},[t]),u=a.useCallback(()=>JSON.stringify(e,null,2),[e]),v=a.useCallback(k=>{try{const b=JSON.parse(k);return b.version!==1?{success:!1,error:`Unsupported version: ${b.version}`}:(t(p=>({...p,nodePositions:b.nodePositions||{},viewState:b.viewState||re})),{success:!0})}catch(b){return{success:!1,error:`Invalid JSON: ${b.message}`}}},[t]),w=a.useMemo(()=>({nodePositions:e.nodePositions,getNodePosition:r,setNodePosition:l,clearNodePositions:c,viewState:e.viewState,setPan:h,setZoom:m,setViewState:f,resetViewState:g,resetAll:y,exportGraphState:u,importGraphState:v}),[e.nodePositions,e.viewState,r,l,c,h,m,f,g,y,u,v]);return i.jsx($n.Provider,{value:w,children:n})}const Kn={version:1,vaultId:"",documents:{}},zn=a.createContext(null);function Wn({children:n,vaultId:o="default"}){const s=`rag-vault-reading-stats-v1-${o}`,[e,t]=F(s,{...Kn,vaultId:o}),r=a.useCallback(p=>e.documents[p],[e.documents]),l=a.useCallback((p,d)=>{const x=e.documents[p];if(x)return x.chunkStats[d]},[e.documents]),c=a.useCallback((p,d)=>{const x=e.documents[p];return x?x.totalChunks!==d?{...x,totalChunks:d}:x:{filePath:p,totalChunks:d,chunksRead:0,totalTimeMs:0,sessions:[],chunkStats:{}}},[e.documents]),h=a.useCallback((p,d,x)=>{t(S=>{const j=c(p,x),A=j.chunkStats[d]||{totalTimeMs:0,readCount:0,lastReadAt:""},M=A.readCount===0,K={...A,readCount:A.readCount+1,lastReadAt:new Date().toISOString()},z={...j,chunksRead:M?j.chunksRead+1:j.chunksRead,chunkStats:{...j.chunkStats,[d]:K}};return{...S,documents:{...S.documents,[p]:z}}})},[t,c]),m=a.useCallback((p,d,x)=>{x<=0||t(S=>{const j=S.documents[p];if(!j)return S;const A=j.chunkStats[d]||{totalTimeMs:0,readCount:0,lastReadAt:new Date().toISOString()},M={...A,totalTimeMs:A.totalTimeMs+x},K=!j.chunkStats[d],z={...j,totalTimeMs:j.totalTimeMs+x,chunksRead:K?j.chunksRead+1:j.chunksRead,chunkStats:{...j.chunkStats,[d]:M}};return{...S,documents:{...S.documents,[p]:z}}})},[t]),f=a.useCallback(p=>{t(d=>{const x=d.documents[p];if(!x)return d;const S=x.sessions[x.sessions.length-1];if(S&&!S.endedAt)return d;const j={startedAt:new Date().toISOString(),endedAt:"",durationMs:0},A=[...x.sessions,j].slice(-10);return{...d,documents:{...d.documents,[p]:{...x,sessions:A}}}})},[t]),g=a.useCallback(p=>{t(d=>{const x=d.documents[p];if(!x)return d;const S=[...x.sessions],j=S[S.length-1];if(!j||j.endedAt)return d;const A=new Date().toISOString(),M=new Date(A).getTime()-new Date(j.startedAt).getTime();return S[S.length-1]={...j,endedAt:A,durationMs:M},{...d,documents:{...d.documents,[p]:{...x,sessions:S}}}})},[t]),y=a.useCallback(p=>{const d=e.documents[p];return!d||d.totalChunks===0?0:Math.round(d.chunksRead/d.totalChunks*100)},[e.documents]),u=a.useCallback(p=>e.documents[p]?.totalTimeMs??0,[e.documents]),v=a.useCallback(p=>{const d=e.documents[p];return!d||d.chunksRead===0?0:Math.round(d.totalTimeMs/d.chunksRead)},[e.documents]),w=a.useCallback(()=>JSON.stringify(e,null,2),[e]),k=a.useCallback(p=>{t(p?d=>{const{[p]:x,...S}=d.documents;return{...d,documents:S}}:d=>({...d,documents:{}}))},[t]),b=a.useMemo(()=>({getDocumentStats:r,getChunkStats:l,recordChunkView:h,recordTimeSpent:m,startSession:f,endSession:g,getCompletionPercent:y,getTotalReadingTime:u,getAverageTimePerChunk:v,exportStats:w,clearStats:k}),[r,l,h,m,f,g,y,u,v,w,k]);return i.jsx(zn.Provider,{value:b,children:n})}const qn=[{to:"/",label:"Search",shortcut:""},{to:"/upload",label:"Upload",shortcut:""},{to:"/files",label:"Files",shortcut:""},{to:"/collections",label:"Collections",shortcut:""},{to:"/status",label:"Status",shortcut:""},{to:"/settings",label:"Settings",shortcut:""}];function Bn({collapsed:n,onToggle:o,width:s}){const{config:e}=pn();return i.jsxs("aside",{className:"ws-left-rail",style:{width:n?"var(--ws-left-rail-collapsed)":s},children:[i.jsx("nav",{className:"ws-left-rail-nav",children:qn.map(t=>i.jsx($t,{content:t.label,side:"right",delay:n?100:1e3,children:i.jsxs(st,{to:t.to,className:({isActive:r})=>`ws-nav-item ${r?"ws-nav-item--active":""} ${n?"ws-nav-item--collapsed":""}`,end:t.to==="/",children:[i.jsx("span",{className:"ws-nav-icon",children:t.label.charAt(0)}),!n&&i.jsx("span",{className:"ws-nav-label",children:t.label})]})},t.to))}),i.jsx("div",{style:{flex:1}}),e&&!n&&i.jsx("div",{className:"ws-left-rail-footer",children:i.jsxs("div",{className:"ws-db-indicator",title:e.dbPath,children:[i.jsx("span",{className:"ws-db-dot"}),i.jsx("span",{className:"ws-db-name",children:e.name}),i.jsxs("span",{className:"ws-db-count",children:[e.documentCount," docs"]})]})}),i.jsx("button",{type:"button",className:"ws-rail-toggle",onClick:o,"aria-label":"Toggle left rail",children:n?"›":"‹"})]})}function Se({onResize:n,direction:o}){const s=a.useRef(0),e=a.useCallback(t=>{t.preventDefault(),s.current=t.clientX;const r=c=>{const h=c.clientX-s.current;s.current=c.clientX,n(o==="right"?-h:h)},l=()=>{document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",l),document.body.style.cursor="",document.body.style.userSelect=""};document.addEventListener("mousemove",r),document.addEventListener("mouseup",l),document.body.style.cursor="col-resize",document.body.style.userSelect="none"},[n,o]);return i.jsx("div",{className:"ws-resize-handle",onMouseDown:e,role:"separator","aria-orientation":"vertical","aria-valuenow":50,tabIndex:0})}const Ce=12;function ae(n={}){const{delay:o=300,hideDelay:s=150}=n,[e,t]=a.useState({isVisible:!1,position:{x:0,y:0},targetRef:null}),r=a.useRef(null),l=a.useRef(null),c=a.useCallback(()=>{r.current!==null&&(clearTimeout(r.current),r.current=null)},[]),h=a.useCallback(()=>{l.current!==null&&(clearTimeout(l.current),l.current=null)},[]),m=a.useCallback(()=>{c(),h()},[c,h]),f=a.useCallback((w,k)=>{h();const b=k.left+k.width/2,p=k.bottom+8,d=Math.max(Ce,Math.min(b,window.innerWidth-Ce)),S=window.innerHeight-k.bottom<200?k.top-8:p;c(),r.current=setTimeout(()=>{t({isVisible:!0,position:{x:d,y:S},targetRef:w})},o)},[o,h,c]),g=a.useCallback(()=>{c(),l.current=setTimeout(()=>{t(w=>({...w,isVisible:!1,targetRef:null}))},s)},[s,c]),y=a.useCallback(()=>{h()},[h]),u=a.useCallback(()=>{l.current=setTimeout(()=>{t(w=>({...w,isVisible:!1,targetRef:null}))},s)},[s]),v=a.useCallback(()=>{m(),t({isVisible:!1,position:{x:0,y:0},targetRef:null})},[m]);return a.useEffect(()=>()=>m(),[m]),{state:e,onHoverStart:f,onHoverEnd:g,onPreviewEnter:y,onPreviewLeave:u,hide:v}}const se=150,X=12;function Un(n){if(n.length<=se)return n;const o=n.slice(0,se),s=o.lastIndexOf(" ");return s>se*.6?`${o.slice(0,s)}...`:`${o}...`}function Hn(n){return`${Math.round(n*100)}%`}function ie({docTitle:n,excerpt:o,backlinkCount:s,score:e,position:t,onNavigate:r,onOpenInNewTab:l,onPinAsLink:c,onMouseEnter:h,onMouseLeave:m}){const f=a.useRef(null),[g,y]=a.useState(t),[u,v]=a.useState(!0),w=s!==void 0&&s>0||e!==void 0,k=l!==void 0||c!==void 0;return a.useEffect(()=>{const b=f.current;if(!b)return;const p=b.getBoundingClientRect();let{x:d,y:x}=t;d=d-p.width/2,d+p.width>window.innerWidth-X&&(d=window.innerWidth-X-p.width),d<X&&(d=X),x+p.height>window.innerHeight-X&&(x=t.y-p.height-16),x<X&&(x=X),y({x:d,y:x})},[t]),a.useEffect(()=>{const b=requestAnimationFrame(()=>{v(!1)});return()=>cancelAnimationFrame(b)},[]),i.jsxs("div",{ref:f,className:`ws-hover-preview ${u?"ws-hover-preview--entering":""}`,style:{left:g.x,top:g.y},onMouseEnter:h,onMouseLeave:m,children:[i.jsx("div",{className:"ws-hover-preview-title",children:n}),o&&i.jsx("p",{className:"ws-hover-preview-excerpt",children:Un(o)}),w&&i.jsxs("div",{className:"ws-hover-preview-meta",children:[s!==void 0&&s>0&&i.jsxs("span",{className:"ws-badge","data-variant":"link-backlink",children:[s," ",s===1?"backlink":"backlinks"]}),e!==void 0&&i.jsxs("span",{className:"ws-badge","data-variant":"link-semantic",children:[Hn(e)," match"]})]}),i.jsxs("div",{className:"ws-hover-preview-actions",children:[i.jsx("button",{type:"button",className:"ws-button","data-variant":"primary","data-size":"sm",onClick:r,children:"Open"}),k&&i.jsxs("div",{className:"ws-hover-preview-secondary-actions",children:[l&&i.jsx("button",{type:"button",className:"ws-button","data-variant":"ghost","data-size":"sm",onClick:l,children:"New Tab"}),c&&i.jsx("button",{type:"button",className:"ws-button","data-variant":"ghost","data-size":"sm",onClick:c,children:"Pin as Link"})]})]})]})}function L({message:n}){return i.jsx("div",{className:"ws-rail-empty-state",children:i.jsx("p",{children:n})})}function Z(n,o,s){let e=s.initialDeps??[],t,r=!0;function l(){var c,h,m;let f;s.key&&((c=s.debug)!=null&&c.call(s))&&(f=Date.now());const g=n();if(!(g.length!==e.length||g.some((v,w)=>e[w]!==v)))return t;e=g;let u;if(s.key&&((h=s.debug)!=null&&h.call(s))&&(u=Date.now()),t=o(...g),s.key&&((m=s.debug)!=null&&m.call(s))){const v=Math.round((Date.now()-f)*100)/100,w=Math.round((Date.now()-u)*100)/100,k=w/16,b=(p,d)=>{for(p=String(p);p.length<d;)p=" "+p;return p};console.info(`%c⏱ ${b(w,5)} /${b(v,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*k,120))}deg 100% 31%);`,s?.key)}return s?.onChange&&!(r&&s.skipInitialOnChange)&&s.onChange(t),r=!1,t}return l.updateDeps=c=>{e=c},l}function Ie(n,o){if(n===void 0)throw new Error("Unexpected undefined");return n}const Vn=(n,o)=>Math.abs(n-o)<1.01,Gn=(n,o,s)=>{let e;return function(...t){n.clearTimeout(e),e=n.setTimeout(()=>o.apply(this,t),s)}},je=n=>{const{offsetWidth:o,offsetHeight:s}=n;return{width:o,height:s}},Jn=n=>n,Qn=n=>{const o=Math.max(n.startIndex-n.overscan,0),s=Math.min(n.endIndex+n.overscan,n.count-1),e=[];for(let t=o;t<=s;t++)e.push(t);return e},Xn=(n,o)=>{const s=n.scrollElement;if(!s)return;const e=n.targetWindow;if(!e)return;const t=l=>{const{width:c,height:h}=l;o({width:Math.round(c),height:Math.round(h)})};if(t(je(s)),!e.ResizeObserver)return()=>{};const r=new e.ResizeObserver(l=>{const c=()=>{const h=l[0];if(h?.borderBoxSize){const m=h.borderBoxSize[0];if(m){t({width:m.inlineSize,height:m.blockSize});return}}t(je(s))};n.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(c):c()});return r.observe(s,{box:"border-box"}),()=>{r.unobserve(s)}},Te={passive:!0},Ee=typeof window>"u"?!0:"onscrollend"in window,Yn=(n,o)=>{const s=n.scrollElement;if(!s)return;const e=n.targetWindow;if(!e)return;let t=0;const r=n.options.useScrollendEvent&&Ee?()=>{}:Gn(e,()=>{o(t,!1)},n.options.isScrollingResetDelay),l=f=>()=>{const{horizontal:g,isRtl:y}=n.options;t=g?s.scrollLeft*(y&&-1||1):s.scrollTop,r(),o(t,f)},c=l(!0),h=l(!1);s.addEventListener("scroll",c,Te);const m=n.options.useScrollendEvent&&Ee;return m&&s.addEventListener("scrollend",h,Te),()=>{s.removeEventListener("scroll",c),m&&s.removeEventListener("scrollend",h)}},Zn=(n,o,s)=>{if(o?.borderBoxSize){const e=o.borderBoxSize[0];if(e)return Math.round(e[s.options.horizontal?"inlineSize":"blockSize"])}return n[s.options.horizontal?"offsetWidth":"offsetHeight"]},es=(n,{adjustments:o=0,behavior:s},e)=>{var t,r;const l=n+o;(r=(t=e.scrollElement)==null?void 0:t.scrollTo)==null||r.call(t,{[e.options.horizontal?"left":"top"]:l,behavior:s})};class ts{constructor(o){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.currentScrollToIndex=null,this.measurementsCache=[],this.itemSizeCache=new Map,this.laneAssignments=new Map,this.pendingMeasuredCacheIndexes=[],this.prevLanes=void 0,this.lanesChangedFlag=!1,this.lanesSettling=!1,this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let s=null;const e=()=>s||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:s=new this.targetWindow.ResizeObserver(t=>{t.forEach(r=>{const l=()=>{this._measureElement(r.target,r)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(l):l()})}));return{disconnect:()=>{var t;(t=e())==null||t.disconnect(),s=null},observe:t=>{var r;return(r=e())==null?void 0:r.observe(t,{box:"border-box"})},unobserve:t=>{var r;return(r=e())==null?void 0:r.unobserve(t)}}})(),this.range=null,this.setOptions=s=>{Object.entries(s).forEach(([e,t])=>{typeof t>"u"&&delete s[e]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:Jn,rangeExtractor:Qn,onChange:()=>{},measureElement:Zn,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...s}},this.notify=s=>{var e,t;(t=(e=this.options).onChange)==null||t.call(e,this,s)},this.maybeNotify=Z(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),s=>{this.notify(s)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(s=>s()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var s;const e=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==e){if(this.cleanup(),!e){this.maybeNotify();return}this.scrollElement=e,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((s=this.scrollElement)==null?void 0:s.window)??null,this.elementsCache.forEach(t=>{this.observer.observe(t)}),this.unsubs.push(this.options.observeElementRect(this,t=>{this.scrollRect=t,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(t,r)=>{this.scrollAdjustments=0,this.scrollDirection=r?this.getScrollOffset()<t?"forward":"backward":null,this.scrollOffset=t,this.isScrolling=r,this.maybeNotify()})),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0})}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(s,e)=>{const t=new Map,r=new Map;for(let l=e-1;l>=0;l--){const c=s[l];if(t.has(c.lane))continue;const h=r.get(c.lane);if(h==null||c.end>h.end?r.set(c.lane,c):c.end<h.end&&t.set(c.lane,!0),t.size===this.options.lanes)break}return r.size===this.options.lanes?Array.from(r.values()).sort((l,c)=>l.end===c.end?l.index-c.index:l.end-c.end)[0]:void 0},this.getMeasurementOptions=Z(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled,this.options.lanes],(s,e,t,r,l,c)=>(this.prevLanes!==void 0&&this.prevLanes!==c&&(this.lanesChangedFlag=!0),this.prevLanes=c,this.pendingMeasuredCacheIndexes=[],{count:s,paddingStart:e,scrollMargin:t,getItemKey:r,enabled:l,lanes:c}),{key:!1}),this.getMeasurements=Z(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:s,paddingStart:e,scrollMargin:t,getItemKey:r,enabled:l,lanes:c},h)=>{if(!l)return this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),[];if(this.laneAssignments.size>s)for(const y of this.laneAssignments.keys())y>=s&&this.laneAssignments.delete(y);this.lanesChangedFlag&&(this.lanesChangedFlag=!1,this.lanesSettling=!0,this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),this.pendingMeasuredCacheIndexes=[]),this.measurementsCache.length===0&&!this.lanesSettling&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(y=>{this.itemSizeCache.set(y.key,y.size)}));const m=this.lanesSettling?0:this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[],this.lanesSettling&&this.measurementsCache.length===s&&(this.lanesSettling=!1);const f=this.measurementsCache.slice(0,m),g=new Array(c).fill(void 0);for(let y=0;y<m;y++){const u=f[y];u&&(g[u.lane]=y)}for(let y=m;y<s;y++){const u=r(y),v=this.laneAssignments.get(y);let w,k;if(v!==void 0&&this.options.lanes>1){w=v;const x=g[w],S=x!==void 0?f[x]:void 0;k=S?S.end+this.options.gap:e+t}else{const x=this.options.lanes===1?f[y-1]:this.getFurthestMeasurement(f,y);k=x?x.end+this.options.gap:e+t,w=x?x.lane:y%this.options.lanes,this.options.lanes>1&&this.laneAssignments.set(y,w)}const b=h.get(u),p=typeof b=="number"?b:this.options.estimateSize(y),d=k+p;f[y]={index:y,start:k,size:p,end:d,key:u,lane:w},g[w]=y}return this.measurementsCache=f,f},{key:!1,debug:()=>this.options.debug}),this.calculateRange=Z(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(s,e,t,r)=>this.range=s.length>0&&e>0?ns({measurements:s,outerSize:e,scrollOffset:t,lanes:r}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=Z(()=>{let s=null,e=null;const t=this.calculateRange();return t&&(s=t.startIndex,e=t.endIndex),this.maybeNotify.updateDeps([this.isScrolling,s,e]),[this.options.rangeExtractor,this.options.overscan,this.options.count,s,e]},(s,e,t,r,l)=>r===null||l===null?[]:s({startIndex:r,endIndex:l,overscan:e,count:t}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=s=>{const e=this.options.indexAttribute,t=s.getAttribute(e);return t?parseInt(t,10):(console.warn(`Missing attribute name '${e}={index}' on measured element.`),-1)},this._measureElement=(s,e)=>{const t=this.indexFromElement(s),r=this.measurementsCache[t];if(!r)return;const l=r.key,c=this.elementsCache.get(l);c!==s&&(c&&this.observer.unobserve(c),this.observer.observe(s),this.elementsCache.set(l,s)),s.isConnected&&this.resizeItem(t,this.options.measureElement(s,e,this))},this.resizeItem=(s,e)=>{const t=this.measurementsCache[s];if(!t)return;const r=this.itemSizeCache.get(t.key)??t.size,l=e-r;l!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(t,l,this):t.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=l,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(t.index),this.itemSizeCache=new Map(this.itemSizeCache.set(t.key,e)),this.notify(!1))},this.measureElement=s=>{if(!s){this.elementsCache.forEach((e,t)=>{e.isConnected||(this.observer.unobserve(e),this.elementsCache.delete(t))});return}this._measureElement(s,void 0)},this.getVirtualItems=Z(()=>[this.getVirtualIndexes(),this.getMeasurements()],(s,e)=>{const t=[];for(let r=0,l=s.length;r<l;r++){const c=s[r],h=e[c];t.push(h)}return t},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=s=>{const e=this.getMeasurements();if(e.length!==0)return Ie(e[Ue(0,e.length-1,t=>Ie(e[t]).start,s)])},this.getMaxScrollOffset=()=>{if(!this.scrollElement)return 0;if("scrollHeight"in this.scrollElement)return this.options.horizontal?this.scrollElement.scrollWidth-this.scrollElement.clientWidth:this.scrollElement.scrollHeight-this.scrollElement.clientHeight;{const s=this.scrollElement.document.documentElement;return this.options.horizontal?s.scrollWidth-this.scrollElement.innerWidth:s.scrollHeight-this.scrollElement.innerHeight}},this.getOffsetForAlignment=(s,e,t=0)=>{if(!this.scrollElement)return 0;const r=this.getSize(),l=this.getScrollOffset();e==="auto"&&(e=s>=l+r?"end":"start"),e==="center"?s+=(t-r)/2:e==="end"&&(s-=r);const c=this.getMaxScrollOffset();return Math.max(Math.min(c,s),0)},this.getOffsetForIndex=(s,e="auto")=>{s=Math.max(0,Math.min(s,this.options.count-1));const t=this.measurementsCache[s];if(!t)return;const r=this.getSize(),l=this.getScrollOffset();if(e==="auto")if(t.end>=l+r-this.options.scrollPaddingEnd)e="end";else if(t.start<=l+this.options.scrollPaddingStart)e="start";else return[l,e];if(e==="end"&&s===this.options.count-1)return[this.getMaxScrollOffset(),e];const c=e==="end"?t.end+this.options.scrollPaddingEnd:t.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(c,e,t.size),e]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(s,{align:e="start",behavior:t}={})=>{t==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(s,e),{adjustments:void 0,behavior:t})},this.scrollToIndex=(s,{align:e="auto",behavior:t}={})=>{t==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),s=Math.max(0,Math.min(s,this.options.count-1)),this.currentScrollToIndex=s;let r=0;const l=10,c=m=>{if(!this.targetWindow)return;const f=this.getOffsetForIndex(s,m);if(!f){console.warn("Failed to get offset for index:",s);return}const[g,y]=f;this._scrollToOffset(g,{adjustments:void 0,behavior:t}),this.targetWindow.requestAnimationFrame(()=>{const u=()=>{if(this.currentScrollToIndex!==s)return;const v=this.getScrollOffset(),w=this.getOffsetForIndex(s,y);if(!w){console.warn("Failed to get offset for index:",s);return}Vn(w[0],v)||h(y)};this.isDynamicMode()?this.targetWindow.requestAnimationFrame(u):u()})},h=m=>{this.targetWindow&&this.currentScrollToIndex===s&&(r++,r<l?this.targetWindow.requestAnimationFrame(()=>c(m)):console.warn(`Failed to scroll to index ${s} after ${l} attempts.`))};c(e)},this.scrollBy=(s,{behavior:e}={})=>{e==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+s,{adjustments:void 0,behavior:e})},this.getTotalSize=()=>{var s;const e=this.getMeasurements();let t;if(e.length===0)t=this.options.paddingStart;else if(this.options.lanes===1)t=((s=e[e.length-1])==null?void 0:s.end)??0;else{const r=Array(this.options.lanes).fill(null);let l=e.length-1;for(;l>=0&&r.some(c=>c===null);){const c=e[l];r[c.lane]===null&&(r[c.lane]=c.end),l--}t=Math.max(...r.filter(c=>c!==null))}return Math.max(t-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(s,{adjustments:e,behavior:t})=>{this.options.scrollToFn(s,{behavior:t,adjustments:e},this)},this.measure=()=>{this.itemSizeCache=new Map,this.laneAssignments=new Map,this.notify(!1)},this.setOptions(o)}}const Ue=(n,o,s,e)=>{for(;n<=o;){const t=(n+o)/2|0,r=s(t);if(r<e)n=t+1;else if(r>e)o=t-1;else return t}return n>0?n-1:0};function ns({measurements:n,outerSize:o,scrollOffset:s,lanes:e}){const t=n.length-1,r=h=>n[h].start;if(n.length<=e)return{startIndex:0,endIndex:t};let l=Ue(0,t,r,s),c=l;if(e===1)for(;c<t&&n[c].end<s+o;)c++;else if(e>1){const h=Array(e).fill(0);for(;c<t&&h.some(f=>f<s+o);){const f=n[c];h[f.lane]=f.end,c++}const m=Array(e).fill(s+o);for(;l>=0&&m.some(f=>f>=s);){const f=n[l];m[f.lane]=f.start,l--}l=Math.max(0,l-l%e),c=Math.min(t,c+(e-1-c%e))}return{startIndex:l,endIndex:c}}const Ae=typeof document<"u"?a.useLayoutEffect:a.useEffect;function ss({useFlushSync:n=!0,...o}){const s=a.useReducer(()=>({}),{})[1],e={...o,onChange:(r,l)=>{var c;n&&l?ot.flushSync(s):s(),(c=o.onChange)==null||c.call(o,r,l)}},[t]=a.useState(()=>new ts(e));return t.setOptions(e),Ae(()=>t._didMount(),[]),Ae(()=>t._willUpdate()),t}function os(n){return ss({observeElementRect:Xn,observeElementOffset:Yn,scrollToFn:es,...n})}const rs=50,as=72;function ne({items:n,renderItem:o,getKey:s}){const e=a.useRef(null),t=os({count:n.length,getScrollElement:()=>e.current,estimateSize:()=>as,overscan:5});return n.length<=rs?i.jsx("div",{className:"ws-rail-list",children:n.map((r,l)=>i.jsx("div",{children:o(r,l)},s(r,l)))}):i.jsx("div",{ref:e,className:"ws-rail-list",style:{height:"100%",overflow:"auto"},children:i.jsx("div",{style:{height:t.getTotalSize(),width:"100%",position:"relative"},children:t.getVirtualItems().map(r=>{const l=n[r.index];return i.jsx("div",{"data-index":r.index,ref:t.measureElement,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${r.start}px)`},children:o(l,r.index)},s(l,r.index))})})})}function He(){const{selection:n,select:o}=V(),{backlinks:s,backlinkCount:e}=kn(n.docId??null,n.chunkIndex??null),{state:t,onHoverStart:r,onHoverEnd:l,onPreviewEnter:c,onPreviewLeave:h,hide:m}=ae();if(!n.docId)return i.jsx(L,{message:"Select a document to see backlinks"});if(e===0)return i.jsx(L,{message:"No backlinks found for this document"});const f=t.isVisible?s.find(g=>g.id===t.targetRef):null;return i.jsxs(i.Fragment,{children:[i.jsx(ne,{items:s,getKey:g=>g.id,renderItem:g=>{const y=g.sourceKey.filePath.split("/").pop()??g.sourceKey.filePath;return i.jsxs("button",{type:"button",className:"ws-rail-item",onClick:()=>{m(),o({docId:g.sourceKey.filePath,chunkIndex:g.sourceKey.chunkIndex,source:"backlink"})},onMouseEnter:u=>r(g.id,u.currentTarget.getBoundingClientRect()),onMouseLeave:l,children:[i.jsx("span",{className:"ws-rail-item-title",children:y}),i.jsxs("span",{className:"ws-rail-item-meta",children:["Chunk #",g.sourceKey.chunkIndex]}),g.label&&i.jsx("span",{className:"ws-rail-item-label",children:g.label}),i.jsxs("p",{className:"ws-rail-item-excerpt",children:[g.sourceText.slice(0,120),"..."]})]})}}),f&&i.jsx(ie,{docTitle:f.sourceKey.filePath.split("/").pop()??f.sourceKey.filePath,excerpt:f.sourceText,backlinkCount:e,position:t.position,onNavigate:()=>{m(),o({docId:f.sourceKey.filePath,chunkIndex:f.sourceKey.chunkIndex,source:"backlink"})},onMouseEnter:c,onMouseLeave:h})]})}function is(){const{selection:n,select:o}=V(),{related:s,isLoading:e}=_e(n.docId??null,n.chunkIndex??null),{state:t,onHoverStart:r,onHoverEnd:l,onPreviewEnter:c,onPreviewLeave:h,hide:m}=ae();if(!n.docId)return i.jsx(L,{message:"Select a document to see related passages"});if(e)return i.jsx("div",{className:"ws-rail-loading",children:"Loading related..."});if(!s||s.length===0)return i.jsx(L,{message:"No related passages found"});const f=t.isVisible?s.find(g=>`${g.filePath}-${g.chunkIndex}`===t.targetRef):null;return i.jsxs(i.Fragment,{children:[i.jsx(ne,{items:s,getKey:g=>`${g.filePath}-${g.chunkIndex}`,renderItem:g=>{const y=`${g.filePath}-${g.chunkIndex}`;return i.jsxs("button",{type:"button",className:"ws-rail-item",onClick:()=>{m(),o({docId:g.filePath,chunkIndex:g.chunkIndex,source:"backlink"})},onMouseEnter:u=>r(y,u.currentTarget.getBoundingClientRect()),onMouseLeave:l,children:[i.jsx("span",{className:"ws-rail-item-title",children:g.filePath.split("/").pop()}),i.jsxs("span",{className:"ws-rail-item-meta",children:["Score: ",g.score.toFixed(3)]}),i.jsxs("p",{className:"ws-rail-item-excerpt",children:[g.text.slice(0,120),"..."]})]})}}),f&&i.jsx(ie,{docTitle:f.filePath.split("/").pop()??f.filePath,excerpt:f.text,score:f.score,position:t.position,onNavigate:()=>{m(),o({docId:f.filePath,chunkIndex:f.chunkIndex,source:"backlink"})},onMouseEnter:c,onMouseLeave:h})]})}function ls(){const{selection:n}=V(),{chunks:o}=bn(n.docId??null),{entries:s}=En({chunks:o??[]});return n.docId?s.length===0?i.jsx(L,{message:"No headings found in this document"}):i.jsx("nav",{className:"ws-rail-list",children:s.map(e=>i.jsx("button",{type:"button",className:"ws-rail-item",style:{paddingLeft:`calc(var(--ws-space-3) + ${(e.level-1)*12}px)`},children:i.jsx("span",{className:"ws-rail-item-title",children:e.text})},e.id))}):i.jsx(L,{message:"Select a document to see its outline"})}function cs(){const n=a.useRef(null),[o,s]=a.useState(null),[e,t]=a.useState(!1),[r,l]=a.useState(null);a.useEffect(()=>{const m=new Worker(new URL("/assets/link-indexer.worker-DGXNsXmZ.js",import.meta.url),{type:"module"});return m.onmessage=f=>{const g=f.data;g.type==="scan-complete"&&g.index?(s(g.index),t(!1),l(null)):g.type==="error"&&(l(new Error(g.message??"Worker error")),t(!1))},m.onerror=f=>{l(new Error(f.message||"Worker initialization error")),t(!1)},n.current=m,()=>{m.terminate(),n.current=null}},[]);const c=a.useCallback(m=>{n.current&&(t(!0),l(null),n.current.postMessage({type:"scan",documents:m}))},[]),h=a.useCallback(async()=>{t(!0),l(null);try{const m=await Re(),f=await Promise.all(m.map(async g=>{const y=await Me(g.filePath);return{filePath:g.filePath,chunks:y.map(u=>({chunkIndex:u.chunkIndex,text:u.text}))}}));if(!n.current)return;n.current.postMessage({type:"scan",documents:f})}catch(m){l(m instanceof Error?m:new Error("Failed to fetch documents for scan")),t(!1)}},[]);return{index:o,isScanning:e,error:r,scan:c,rescan:h}}const Ve=a.createContext(null);function ds({children:n}){const{index:o,isScanning:s,rescan:e}=cs(),t=q();a.useEffect(()=>{e()},[e]),a.useEffect(()=>t.getQueryCache().subscribe(g=>{g.type==="updated"&&g.query.queryKey[0]==="files"&&g.action.type==="success"&&e()}),[t,e]);const r=a.useMemo(()=>{if(!o)return new Set;const f=new Set,g=new Set;if(o.outgoing)for(const y of Object.keys(o.outgoing))g.add(y);if(o.incoming)for(const y of Object.values(o.incoming))for(const u of y)g.add(u.sourceDoc);for(const y of g){const u=y.split("/"),v=u[u.length-1]??y,w=v.replace(/\.[^.]+$/,"");f.add(w.toLowerCase()),f.add(v.toLowerCase())}return f},[o]),l=a.useCallback(f=>o?o.outgoing[f]??[]:[],[o]),c=a.useCallback(f=>o?o.incoming[f]??[]:[],[o]),h=a.useCallback(f=>r.has(f.toLowerCase()),[r]),m=a.useMemo(()=>({index:o,isScanning:s,rescan:e,getOutgoingLinks:l,getIncomingLinks:c,isResolved:h}),[o,s,e,l,c,h]);return i.jsx(Ve.Provider,{value:m,children:n})}function Ge(){const n=a.useContext(Ve);if(!n)throw new Error("useLinkIndexContext must be used within a LinkIndexProvider");return n}function us(){const{selection:n,select:o}=V(),{getOutgoingLinks:s,isResolved:e,isScanning:t}=Ge(),{state:r,onHoverStart:l,onHoverEnd:c,onPreviewEnter:h,onPreviewLeave:m,hide:f}=ae(),g=a.useMemo(()=>n.docId?s(n.docId):[],[n.docId,s]);if(!n.docId)return i.jsx(L,{message:"Select a document to see outgoing links"});if(t)return i.jsx("div",{className:"ws-rail-loading",children:"Scanning links..."});if(g.length===0)return i.jsx(L,{message:"No outgoing links found"});const y=r.isVisible?g.find((u,v)=>`${u.targetTitle}-${u.chunkIndex}-${v}`===r.targetRef):null;return i.jsxs(i.Fragment,{children:[i.jsx(ne,{items:g,getKey:(u,v)=>`${u.targetTitle}-${u.chunkIndex}-${v}`,renderItem:(u,v)=>{const w=e(u.targetTitle),k=`${u.targetTitle}-${u.chunkIndex}-${v}`,b=[];return u.heading&&b.push(`# ${u.heading}`),u.blockRef&&b.push(`^ ${u.blockRef}`),b.push(`Chunk #${u.chunkIndex}`),i.jsxs("button",{type:"button",className:"ws-rail-item",disabled:!w,onClick:()=>{w&&(f(),o({docId:u.targetTitle,source:"backlink"}))},onMouseEnter:p=>{w&&l(k,p.currentTarget.getBoundingClientRect())},onMouseLeave:c,children:[i.jsx("span",{className:"ws-rail-item-title",children:u.alias??u.targetTitle}),i.jsx("span",{className:"ws-rail-item-meta",children:b.join(" - ")}),i.jsx(oe,{variant:w?"link-explicit":"link-unresolved",children:w?"Resolved":"Unresolved"})]})}}),y&&i.jsx(ie,{docTitle:y.alias??y.targetTitle,excerpt:y.heading?`# ${y.heading}`:void 0,position:r.position,onNavigate:()=>{f(),o({docId:y.targetTitle,source:"backlink"})},onMouseEnter:h,onMouseLeave:m})]})}function hs(n){const o=n.split("/");return(o[o.length-1]??n).replace(/\.[^.]+$/,"")}function fs(){const{selection:n,select:o}=V(),{index:s,isScanning:e,getIncomingLinks:t}=Ge(),r=a.useMemo(()=>n.docId?hs(n.docId):null,[n.docId]),l=a.useMemo(()=>{if(!r)return[];const m=t(r);if(m.length===0)return[];const f=new Map;for(const g of m){const y=f.get(g.sourceDoc);y?y.push(g):f.set(g.sourceDoc,[g])}return Array.from(f.entries()).map(([g,y])=>({sourceDoc:g,edges:y}))},[r,t]),c=a.useMemo(()=>{if(!r||!s)return 0;const m=new Set(t(r).map(g=>g.sourceDoc));let f=0;for(const g of Object.keys(s.outgoing))g!==n.docId&&(m.has(g)||f++);return f},[r,s,n.docId,t]);if(!n.docId)return i.jsx(L,{message:"Select a document to see unlinked mentions"});if(e)return i.jsx("div",{className:"ws-rail-loading",children:"Scanning for mentions..."});if(!s)return i.jsx(L,{message:"Link index not available"});const h=l.length>0;return!h&&c===0?i.jsx(L,{message:"No mentions found for this document"}):i.jsxs("div",{className:"ws-rail-list",children:[h&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"ws-rail-item-meta",style:{padding:"0.5rem 0.75rem"},children:["Linked mentions",i.jsx(oe,{variant:"success",count:l.length,style:{marginLeft:"0.5rem"},children:"linked"})]}),i.jsx(ne,{items:l,getKey:m=>m.sourceDoc,renderItem:m=>{const f=m.sourceDoc.split("/").pop()??m.sourceDoc,g=m.edges.map(y=>`#${y.chunkIndex}`).join(", ");return i.jsxs("button",{type:"button",className:"ws-rail-item",onClick:()=>{o({docId:m.sourceDoc,source:"backlink"})},children:[i.jsx("span",{className:"ws-rail-item-title",children:f}),i.jsxs("span",{className:"ws-rail-item-meta",children:[m.edges.length," link",m.edges.length!==1?"s":""," - Chunks"," ",g]})]})}})]}),c>0&&i.jsxs("div",{className:"ws-rail-item-meta",style:{padding:"0.5rem 0.75rem",marginTop:h?"0.75rem":0},children:[i.jsx(oe,{variant:"info",count:c,style:{marginRight:"0.5rem"},children:"unlinked"}),c," document",c!==1?"s":"",' scanned without a link to "',r,'".',i.jsx("p",{className:"ws-rail-item-excerpt",style:{marginTop:"0.375rem"},children:"Full text scanning for unlinked mentions requires fetching all document chunks and is planned for a future update."})]})]})}const Je={nodeRadius:8,activeNodeRadius:12,currentNodeColor:"#3b82f6",defaultNodeColor:"#9ca3af",pinnedNodeColor:"#10b981",edgeWidth:1.5,pinnedEdgeColor:"#3b82f6",semanticEdgeColor:"#d1d5db",backlinkEdgeColor:"#8b5cf6",repulsionStrength:150,attractionStrength:.3,centerGravity:.05,velocityDecay:.4,maxNodes:150,neighborsToShow:10};function gs({graphData:n,config:o,width:s,height:e,enabled:t=!0}){const r=a.useMemo(()=>({...Je,...o}),[o]),[l,c]=a.useState([]),[h,m]=a.useState(!1),f=a.useRef(null),g=a.useRef(0);a.useEffect(()=>{const w=s/2,k=e/2,b=n.nodes.map((p,d)=>{const x=l.find(A=>A.id===p.id);if(x&&x.x!==void 0&&x.y!==void 0)return{...p,x:x.x,y:x.y,vx:0,vy:0};const S=d/n.nodes.length*Math.PI*2,j=Math.min(s,e)*.3;return{...p,x:w+Math.cos(S)*j+(Math.random()-.5)*50,y:k+Math.sin(S)*j+(Math.random()-.5)*50,vx:0,vy:0}});c(b),m(!1),g.current=0},[n.nodes.length,s,e,n.nodes.map,l.find]);const y=a.useRef(new Map);a.useEffect(()=>{const w=new Map;for(const k of n.edges){const b=w.get(k.source)||[];b.push(k.target),w.set(k.source,b);const p=w.get(k.target)||[];p.push(k.source),w.set(k.target,p)}y.current=w},[n.edges]);const u=a.useCallback(()=>{if(!t||l.length===0)return!1;const w=s/2,k=e/2;let b=0;const p=l.map(d=>{let x=0,S=0;if(d.fx!==void 0&&d.fx!==null&&d.fy!==void 0&&d.fy!==null)return{...d,x:d.fx,y:d.fy};for(const I of l){if(I.id===d.id)continue;const N=(d.x??0)-(I.x??0),T=(d.y??0)-(I.y??0),R=Math.sqrt(N*N+T*T)||1,D=r.repulsionStrength/(R*R);x+=N/R*D,S+=T/R*D}const j=y.current.get(d.id)||[];for(const I of j){const N=l.find(D=>D.id===I);if(!N)continue;const T=(N.x??0)-(d.x??0),R=(N.y??0)-(d.y??0);x+=T*r.attractionStrength,S+=R*r.attractionStrength}x+=(w-(d.x??0))*r.centerGravity,S+=(k-(d.y??0))*r.centerGravity;const A=((d.vx??0)+x)*(1-r.velocityDecay),M=((d.vy??0)+S)*(1-r.velocityDecay),K=(d.x??0)+A,z=(d.y??0)+M,U=40,P=Math.max(U,Math.min(s-U,K)),E=Math.max(U,Math.min(e-U,z)),C=Math.sqrt(A*A+M*M);return b=Math.max(b,C),{...d,x:P,y:E,vx:A,vy:M}});return c(p),g.current++,b>.5&&g.current<300},[l,t,s,e,r]);a.useEffect(()=>{if(!t){f.current&&cancelAnimationFrame(f.current);return}const w=()=>{u()?f.current=requestAnimationFrame(w):m(!0)};return f.current=requestAnimationFrame(w),()=>{f.current&&cancelAnimationFrame(f.current)}},[u,t]);const v=a.useCallback(()=>{m(!1),g.current=0,c(w=>w.map(k=>({...k,vx:(Math.random()-.5)*10,vy:(Math.random()-.5)*10})))},[]);return{nodes:l,isStable:h,reheat:v}}function ms({graphData:n,currentNodeId:o,pinnedNodeIds:s,onNodeClick:e,config:t}){const r=a.useRef(null),l=a.useRef(null),[c,h]=a.useState({width:600,height:300}),[m,f]=a.useState(null),[g,y]=a.useState(null),[u,v]=a.useState({x:0,y:0}),[w,k]=a.useState(1),b=a.useRef(!1),p=a.useRef({x:0,y:0}),d=a.useMemo(()=>({...Je,...t}),[t]),{nodes:x,isStable:S}=gs({graphData:n,config:t,width:c.width,height:c.height,enabled:n.nodes.length>0});a.useEffect(()=>{const C=l.current;if(!C)return;const I=new ResizeObserver(N=>{const T=N[0];T&&h({width:T.contentRect.width,height:T.contentRect.height})});return I.observe(C),()=>I.disconnect()},[]);const j=a.useCallback((C,I)=>{const N=r.current;if(!N)return{x:0,y:0};const T=N.getBoundingClientRect(),R=(C-T.left-u.x)/w,D=(I-T.top-u.y)/w;return{x:R,y:D}},[u,w]),A=a.useCallback((C,I)=>{for(const N of x){if(N.x===void 0||N.y===void 0)continue;const T=C-N.x,R=I-N.y,D=N.id===o?d.activeNodeRadius:d.nodeRadius;if(T*T+R*R<=D*D*1.5)return N}return null},[x,o,d.nodeRadius,d.activeNodeRadius]),M=a.useCallback(C=>{b.current=!0,p.current={x:C.clientX,y:C.clientY}},[]),K=a.useCallback(()=>{b.current=!1},[]),z=a.useCallback(C=>{if(b.current){const R=C.clientX-p.current.x,D=C.clientY-p.current.y;v(W=>({x:W.x+R,y:W.y+D})),p.current={x:C.clientX,y:C.clientY};return}const{x:I,y:N}=j(C.clientX,C.clientY),T=A(I,N);if(f(T),T){const R=r.current;if(R){const D=R.getBoundingClientRect();y({x:C.clientX-D.left,y:C.clientY-D.top,node:T})}}else y(null)},[j,A]),U=a.useCallback(C=>{const{x:I,y:N}=j(C.clientX,C.clientY),T=A(I,N);T&&e&&e(T)},[j,A,e]),P=a.useCallback(C=>{C.preventDefault();const I=C.deltaY>0?.9:1.1;k(N=>Math.max(.3,Math.min(3,N*I)))},[]);a.useEffect(()=>{const C=r.current;if(!C)return;const I=C.getContext("2d");if(!I)return;C.width=c.width*window.devicePixelRatio,C.height=c.height*window.devicePixelRatio,I.scale(window.devicePixelRatio,window.devicePixelRatio),I.clearRect(0,0,c.width,c.height),I.save(),I.translate(u.x,u.y),I.scale(w,w);const N=new Map;for(const T of x)T.x!==void 0&&T.y!==void 0&&N.set(T.id,{x:T.x,y:T.y});for(const T of n.edges){const R=N.get(T.source),D=N.get(T.target);!R||!D||(I.beginPath(),I.moveTo(R.x,R.y),I.lineTo(D.x,D.y),I.strokeStyle=T.type==="pinned"?d.pinnedEdgeColor:T.type==="backlink"?d.backlinkEdgeColor:d.semanticEdgeColor,I.lineWidth=T.type==="pinned"?d.edgeWidth*1.5:d.edgeWidth,T.type==="semantic"?I.setLineDash([4,4]):I.setLineDash([]),I.stroke())}I.setLineDash([]);for(const T of x){if(T.x===void 0||T.y===void 0)continue;const R=T.id===o,D=s.has(T.id),W=m?.id===T.id,Y=R?d.activeNodeRadius:d.nodeRadius,Xe=R?d.currentNodeColor:D?d.pinnedNodeColor:d.defaultNodeColor;I.beginPath(),I.arc(T.x,T.y,W?Y*1.3:Y,0,Math.PI*2),I.fillStyle=Xe,I.fill(),I.strokeStyle=W?"#fff":"rgba(0,0,0,0.2)",I.lineWidth=W?2:1,I.stroke(),R&&(I.font="10px sans-serif",I.fillStyle="#fff",I.textAlign="center",I.textBaseline="middle",I.fillText("●",T.x,T.y))}I.restore()},[x,n.edges,c,u,w,o,s,m,d]);const E=C=>{const I=C.split(/[/\\]/);return I[I.length-1]||C};return i.jsxs("div",{ref:l,className:"w-full h-full relative rounded-lg overflow-hidden",style:{background:"var(--ws-surface-1)"},children:[i.jsx("canvas",{ref:r,className:"w-full h-full cursor-grab active:cursor-grabbing",style:{width:c.width,height:c.height},onMouseDown:M,onMouseUp:K,onMouseMove:z,onMouseLeave:()=>{f(null),y(null),b.current=!1},onClick:U,onWheel:P}),g&&i.jsxs("div",{className:"absolute pointer-events-none z-10 max-w-xs px-3 py-2 text-xs rounded-lg shadow-lg",style:{background:"var(--ws-surface-0)",color:"var(--ws-text)",left:Math.min(g.x+10,c.width-200),top:Math.min(g.y+10,c.height-60)},children:[i.jsx("p",{className:"font-medium truncate",children:E(g.node.filePath)}),i.jsxs("p",{style:{color:"var(--ws-text-faint)"},children:["Chunk #",g.node.chunkIndex]}),i.jsx("p",{className:"mt-1 line-clamp-2",style:{color:"var(--ws-text-muted)"},children:g.node.text})]}),i.jsxs("div",{className:"absolute bottom-2 right-2 flex gap-1",children:[i.jsx("button",{type:"button",onClick:()=>k(C=>Math.min(3,C*1.2)),className:"p-1.5 rounded shadow",style:{background:"var(--ws-surface-raised)",color:"var(--ws-text-secondary)"},title:"Zoom in",children:i.jsx(ps,{className:"w-4 h-4"})}),i.jsx("button",{type:"button",onClick:()=>k(C=>Math.max(.3,C*.8)),className:"p-1.5 rounded shadow",style:{background:"var(--ws-surface-raised)",color:"var(--ws-text-secondary)"},title:"Zoom out",children:i.jsx(bs,{className:"w-4 h-4"})}),i.jsx("button",{type:"button",onClick:()=>{v({x:0,y:0}),k(1)},className:"p-1.5 rounded shadow",style:{background:"var(--ws-surface-raised)",color:"var(--ws-text-secondary)"},title:"Reset view",children:i.jsx(xs,{className:"w-4 h-4"})}),!S&&i.jsx("span",{className:"p-1.5 text-xs",style:{color:"var(--ws-text-muted)"},children:"Simulating..."})]}),i.jsxs("div",{className:"absolute top-2 left-2 text-xs px-2 py-1 rounded",style:{color:"var(--ws-text-secondary)",background:"var(--ws-surface-raised)"},children:[i.jsxs("span",{className:"inline-flex items-center gap-1",children:[i.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:d.currentNodeColor}}),"Current"]}),i.jsxs("span",{className:"inline-flex items-center gap-1 ml-3",children:[i.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:d.pinnedNodeColor}}),"Pinned"]}),i.jsxs("span",{className:"inline-flex items-center gap-1 ml-3",children:[i.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:d.defaultNodeColor}}),"Related"]})]})]})}function ps({className:n}){return i.jsx("svg",{className:n,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}function bs({className:n}){return i.jsx("svg",{className:n,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 12H4"})})}function xs({className:n}){return i.jsx("svg",{className:n,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}function ys(){const{selection:n,select:o}=V(),s=n.docId??null,e=n.chunkIndex??null,{related:t,isLoading:r}=_e(s,e),{pins:l}=wn(),{graphData:c,currentNodeId:h}=Rn({filePath:s??"",activeChunkIndex:e,relatedChunks:t,pins:l}),m=a.useMemo(()=>{const g=new Set;for(const y of l)g.add(`${y.sourceKey.filePath}:${y.sourceKey.chunkIndex}`),g.add(`${y.targetKey.filePath}:${y.targetKey.chunkIndex}`);return g},[l]),f=g=>{o({docId:g.filePath,chunkIndex:g.chunkIndex,source:"graph"})};return s?r?i.jsx("div",{className:"ws-rail-loading",children:"Loading graph..."}):c.nodes.length===0?i.jsx(L,{message:"No graph data available"}):i.jsx("div",{style:{height:"100%",minHeight:300},children:i.jsx(ms,{graphData:c,currentNodeId:h,pinnedNodeIds:m,onNodeClick:f})}):i.jsx(L,{message:"Select a document to see its graph"})}const ws=[{id:"backlinks",label:"Backlinks"},{id:"outgoing",label:"Outgoing"},{id:"related",label:"Related"},{id:"mentions",label:"Mentions"},{id:"outline",label:"Outline"},{id:"graph",label:"Graph"}],ks={backlinks:He,outgoing:us,related:is,mentions:fs,outline:ls,graph:ys};function vs({collapsed:n,onToggle:o,width:s}){const[e,t]=F("ws-right-rail-tab","backlinks");if(n)return i.jsx("aside",{className:"ws-right-rail ws-right-rail--collapsed",children:i.jsx("button",{type:"button",className:"ws-rail-toggle",onClick:o,"aria-label":"Toggle right rail",children:"‹"})});const r=ks[e]??He;return i.jsxs("aside",{className:"ws-right-rail",style:{width:s},children:[i.jsxs("div",{className:"ws-right-rail-header",children:[i.jsx(Fe,{tabs:ws,activeId:e,onSelect:l=>t(l),variant:"pill",className:"ws-right-rail-tabs"}),i.jsx("button",{type:"button",className:"ws-rail-toggle",onClick:o,"aria-label":"Toggle right rail",children:"›"})]}),i.jsx("div",{className:"ws-right-rail-content",children:i.jsx(r,{})})]})}function Ss(){const n=ue({storageKey:"left-rail",defaultWidth:220,min:180,max:320}),o=ue({storageKey:"right-rail",defaultWidth:300,min:240,max:420}),{selection:s,select:e}=V(),t=dt(),r=a.useRef(!1);a.useEffect(()=>{if(r.current){r.current=!1;return}s.docId&&t.push(s.docId,s.chunkIndex)},[s.docId,s.chunkIndex]);const l=a.useCallback(()=>{const h=t.goBack();h&&(r.current=!0,e({docId:h.docId,chunkIndex:h.chunkIndex,source:"backlink"}))},[t,e]),c=a.useCallback(()=>{const h=t.goForward();h&&(r.current=!0,e({docId:h.docId,chunkIndex:h.chunkIndex,source:"backlink"}))},[t,e]);return ut({onToggleLeftRail:n.toggleCollapsed,onToggleRightRail:o.toggleCollapsed,onNavigateBack:l,onNavigateForward:c}),i.jsxs("div",{className:"ws-shell",children:[i.jsx(Nt,{}),i.jsx(Bn,{collapsed:n.collapsed,onToggle:n.toggleCollapsed,width:n.width}),!n.collapsed&&i.jsx(Se,{direction:"left",onResize:h=>n.setWidth(n.width+h)}),i.jsx(Gt,{}),!o.collapsed&&i.jsx(Se,{direction:"right",onResize:h=>o.setWidth(o.width+h)}),i.jsx(vs,{collapsed:o.collapsed,onToggle:o.toggleCollapsed,width:o.width})]})}function Cs(){return i.jsx(lt,{children:i.jsx(Ss,{})})}const Is=a.createContext(null);function js({children:n,vaultId:o="default"}){const s=`rag-vault-reading-mode-${o}`,[e,t]=F(s,"full"),r=a.useCallback(h=>{t(h)},[t]),l=a.useCallback(()=>{t(h=>h==="skim"?"full":"skim")},[t]),c=a.useMemo(()=>({mode:e,setMode:r,toggleMode:l,isSkimMode:e==="skim",isFullMode:e==="full"}),[e,r,l]);return i.jsx(Is.Provider,{value:c,children:n})}const Ts=new Ye({defaultOptions:{queries:{staleTime:1e3*60,retry:1}}}),Qe=document.getElementById("root");if(!Qe)throw new Error('Root element not found. Ensure index.html has <div id="root"></div>');it.createRoot(Qe).render(i.jsx(a.StrictMode,{children:i.jsx(Ze,{client:Ts,children:i.jsx(rt,{children:i.jsx(Xt,{children:i.jsx(jt,{children:i.jsx(ct,{children:i.jsx(Mt,{dbId:"default",children:i.jsx(yn,{children:i.jsx(ds,{children:i.jsx(Pn,{children:i.jsx(Dn,{children:i.jsx(Fn,{children:i.jsx(_n,{children:i.jsx(js,{children:i.jsx(Wn,{children:i.jsx(Cs,{})})})})})})})})})})})})})})})}));export{Fs as A,Ks as B,Zs as C,$s as D,_s as E,zs as F,Ws as G,qs as H,ms as K,xt as S,Xs as T,Fe as W,F as a,Qs as b,Rn as c,bn as d,En as e,wn as f,Ds as g,Ps as h,Rs as i,Tt as j,to as k,Ys as l,eo as m,Ms as n,Os as o,Bs as p,Us as q,Hs as r,Ns as s,Vs as t,ze as u,_ as v,Gs as w,Js as x,pn as y,Ls as z};
