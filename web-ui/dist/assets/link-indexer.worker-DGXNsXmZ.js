(function(){"use strict";const c=/\[\[([^\]|#^]+?)(?:#([^\]|^]+?))?(?:\^([^\]|]+?))?(?:\|([^\]]+?))?\]\]/g;function g(s){const t=[];c.lastIndex=0;for(let e=c.exec(s);e!==null;e=c.exec(s))t.push({docTitle:e[1].trim(),heading:e[2]?.trim(),blockRef:e[3]?.trim(),alias:e[4]?.trim(),start:e.index,end:e.index+e[0].length});return t}function u(s){const t={},e={},o=new Set;let a=0;for(const i of s){const r=[];for(const d of i.chunks){const h=g(d.text);for(const n of h){const l={sourceDoc:i.filePath,targetTitle:n.docTitle,heading:n.heading,blockRef:n.blockRef,alias:n.alias,chunkIndex:d.chunkIndex,position:{start:n.start,end:n.end}};r.push(l),o.add(n.docTitle);const f=e[n.docTitle];f?f.push(l):e[n.docTitle]=[l],a++}}r.length>0&&(t[i.filePath]=r)}return{outgoing:t,incoming:e,referencedTitles:Array.from(o).sort(),totalLinks:a,totalDocuments:s.length}}self.onmessage=s=>{const t=s.data;if(t.type==="scan")try{const o={type:"scan-complete",index:u(t.documents)};self.postMessage(o)}catch(e){const o={type:"error",message:e instanceof Error?e.message:"Unknown worker error"};self.postMessage(o)}}})();
